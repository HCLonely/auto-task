// ==UserScript==
// @name               auto-task-new
// @namespace          auto-task-new
// @version            4.0.13-Alpha
// @description        赠Key站自动任务
// @author             HCLonely
// @run-at             document-start
// @compatible         chrome 没有测试其他浏览器的兼容性

// @include            *://freeanywhere.net/*
// @include            *://giveaway.su/giveaway/view/*
// @include            *://givee.club/*/event/*
// @include            *://givekey.ru/giveaway/*
// @include            *://www.indiedb.com/giveaways*
// @include            *://key-hub.eu/giveaway/*
// @include            *://keylol.com/*
// @include            *://www.opiumpulses.com/giveaways
// @include            *://prys.revadike.com/giveaway/?id=*
// @include            *://opquests.com/quests/*
// @include            *://gleam.io/*
// @include            *://discord.com/*
// @include            *://www.twitch.tv/*
// @include            *://www.youtube.com/*
// @include            *://*.reddit.com/*
// @include            *://twitter.com/settings/account?k*

// @grant              GM_setValue
// @grant              GM_getValue
// @grant              GM_listValues
// @grant              GM_deleteValue
// @grant              GM_addValueChangeListener
// @grant              GM_addStyle
// @grant              GM_xmlhttpRequest
// @grant              GM_getResourceText
// @grant              GM_registerMenuCommand
// @grant              GM_info
// @grant              GM_openInTab
// @grant              GM_notification
// @grant              unsafeWindow
// @grant              window.close
// @grant              window.localStorage

// @connect            cdn.jsdelivr.net
// @connect            store.steampowered.com
// @connect            steamcommunity.com
// @connect            twitter.com
// @connect            api.twitter.com
// @connect            youtube.com
// @connect            www.youtube.com
// @connect            facebook.com
// @connect            instagram.com
// @connect            vk.com
// @connect            twitch.tv
// @connect            www.twitch.tv
// @connect            gql.twitch.tv
// @connect            github.com
// @connect            discordapp.com
// @connect            discord.gg
// @connect            discord.com
// @connect            www.reddit.com
// @connect            oauth.reddit.com
// @connect            raw.githubusercontent.com
// @connect            t.me
// @connect            bit.ly
// @connect            giveaway.su
// @connect            google.com
// @connect            *
// @require            https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js
// @require            https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js
// @require            https://cdn.jsdelivr.net/npm/regenerator-runtime@0.13.5/runtime.min.js
// @require            https://cdn.jsdelivr.net/npm/js-sha1@0.6.0/src/sha1.min.js
// @require            https://cdn.jsdelivr.net/npm/sweetalert2@11
// ==/UserScript==

console.log('%c%s', 'color:blue', 'Auto Task脚本开始加载');

!function(){"use strict";var i={n:function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,{a:e}),e},d:function(t,e){for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}},t=Swal,o=i.n(t);const d=Cookies;function A(t,e){console.log("%c%s","color:white;background:red",`${e}\n${t.stack}`)}async function n(s){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;try{var e=await new Promise(e=>{s.dataType&&(s.responseType=s.dataType);var t={timeout:3e4,ontimeout(t){e({result:"Error",statusText:"Timeout",status:601,data:t,options:s})},onabort(t){e({result:"Error",statusText:"Aborted",status:602,data:t,options:s})},onerror(t){e({result:"Error",statusText:"Error",status:603,data:t,options:s})},onload(t){e({result:"Success",statusText:"Load",status:600,data:t,options:s})},...s};GM_xmlhttpRequest(t)});return console.log("发送请求:",e),600!==e.status&&t<2?n(s,t+1):e}catch(t){return A(t,"httpRequest"),console.log("发送请求:",{errorMsg:t,options:s}),{result:"JsError",statusText:"Error",status:604,error:t,options:s}}}const S=n;const a={zh:{website:"网站",type:"类型",edit:"编辑",whiteList:"白名单",skipTask:"跳过取消做任务",whiteListOptions:"白名单设置",changeWhiteListOption:"设置白名单(%0)",whiteListNotFound:"找不到此项白名单: %0",changeWhiteListSuccess:"白名单修改成功，刷新生效！",save:"保存",close:"关闭",return:"返回",option:"选项",value:"值",websiteOptions:"当前网站设置",changeWebsiteOptionsSuccess:"更改当前网站设置成功，刷新生效！",needLogin:"请先登录！",getTasksInfo:"正在获取并处理任务信息",gettingKey:"正在获取Key...",verifyingTask:"正在验证任务",notice:"自动任务脚本提醒",noKeysLeft:"此页面已经没有剩余key了，是否关闭？",confirm:"确定",cancel:"取消",unKnown:"未知",unKnownTaskType:"未识别的任务",doing:"正在做任务",allTasksComplete:"所有任务已完成！",getTaskIdFailed:"获取任务Id失败！",initSuccess:"%0 初始化成功！",initFailed:"%0 初始化失败！",errorLink:"链接错误: %0",needInit:"请先初始化",verifyingAuth:"正在验证%0凭证...",updatingAuth:"正在更新%0凭证...",initing:"正在初始化...",getFailed:"获取%0失败！",checkLoginFailed:"检测登录状态失败！",checkLeftKeyFailed:"检测剩余Key失败！",userId:"用户Id",giveKeyNotice:'如果没有key, 请在<a href="https://givekey.ru/profile" target="_blank">https://givekey.ru/profile</a>查看',joiningGiveaway:"正在加入赠Key",needJoinGiveaway:"需要先加入赠Key",cannotUndo:"此网站不支持取消任务",steamCommunity:"Steam社区",steamStore:"Steam商店",needLoginSteamStore:'请先<a href="https://store.steampowered.com/login/" target="_blank">登录Steam商店</a>',needLoginSteamCommunity:'请先<a href="https://steamcommunity.com/login/home/" target="_blank">登录Steam社区</a>',joiningSteamGroup:"正在加入Steam组",leavingSteamGroup:"正在退出Steam组",gettingSteamGroupId:"正在获取Steam组Id",subscribingForum:"正在订阅Steam论坛",unsubscribingForum:"正在取消订阅Steam论坛",gettingForumId:"正在获取Steam论坛Id",followingCurator:"正在关注Steam鉴赏家",unfollowingCurator:"正在取关Steam鉴赏家",addingToWishlist:"正在添加游戏到Steam愿望单",removingFromWishlist:"正在从Steam愿望单移除游戏",followingGame:"正在关注Steam游戏",unfollowingGame:"正在取关Steam游戏",favoritingWorkshop:"正在收藏Steam创意工坊物品",unfavoritingWorkshop:"正在取消收藏Steam创意工坊物品",gettingWorkshopAppId:"正在获取Steam创意工坊物品Id",votingUpWorkshop:"正在点赞Steam创意工坊物品",gettingAnnouncementParams:"正在获取Steam通知信息",likingAnnouncement:"正在点赞Steam通知",changingArea:"正在更换Steam地区: %0...",notNeededChangeArea:"当前地区不需要更换",noAnotherArea:"请检测是否开启正确开启代理",gettingAreaInfo:"正在获取Steam地区信息...",joiningDiscordServer:"正在加入Discord服务器",leavingDiscordServer:"正在退出Discord服务器",gettingDiscordGuild:"正在获取Discord服务器Id",loginIns:'请先<a href="https://www.instagram.com/accounts/login/" target="_blank">登录Instagram</a>',insBanned:"您的Instagram账户已被封禁",verifyingInsAuth:"正在验证Instagram凭证...",gettingInsUserId:"正在获取Instagram用户Id",followingIns:"正在关注Instagram用户",unfollowingIns:"正在取关Instagram用户",loginReddit:'请先<a href="https://www.reddit.com/login/" target="_blank">登录Reddit</a>',changingRedditVersion:"正在切换Reddit为新版页面...",joiningReddit:"正在加入Reddit社区",leavingReddit:"正在退出Reddit社区",followingRedditUser:"正在关注Reddit用户",unfollowingRedditUser:"正在取关Reddit用户",followingTwitchChannel:"正在关注Twitch频道",unfollowingTwitchChannel:"正在取关Twitch频道",gettingTwitchChannelId:"正在获取Twitch频道Id",followingTwitterUser:"正在关注推特用户",unfollowingTwitterUser:"正在取关推特用户",retweetting:"正在转推",unretweetting:"正在撤销转推",loginVk:'请先<a href="https://vk.com/login/" target="_blank">登录Vk</a>',gettingVkId:"正在获取Vk任务Id",joiningVkGroup:"正在加入Vk组",leavingVkGroup:"正在退出Vk组",joiningVkPublic:"正在加入Vk社区",leavingVkPublic:"正在退出Vk社区",sendingVkWall:"正在转发Vk动态",deletingVkWall:"正在撤销转发Vk动态",loginYtb:'请先<a href="https://accounts.google.com/ServiceLogin?service=youtube" target="_blank">登录YouTube</a>',tryUpdateYtbAuth:'请尝试<a href="https://www.youtube.com/#auth" target="_blank">更新YouTube凭证</a>',gettingYtbToken:"正在获取YouTube Token...",followingYtbChannel:"正在订阅YouTube频道",unfollowingYtbChannel:"正在退订YouTube频道",likingYtbVideo:"正在点赞YouTube视频",unlikingYtbVideo:"正在取消点赞YouTube视频",noPoints:"点数不够，跳过抽奖",getNeedPointsFailed:"获取所需点数失败，跳过抽奖",joiningLottery:"正在加入抽奖",doingGleamTask:"正在做Gleam任务...",gettingGleamLink:"正在获取Gleam任务链接...",gleamTaskNotice:"如果此页面长时间未关闭，请完成任一任务后自行关闭！"}};const G=function(t){for(var e,s=arguments.length,i=new Array(1<s?s-1:0),n=1;n<s;n++)i[n-1]=arguments[n];return null!==(e=a.zh)&&void 0!==e&&e[t]?a.zh[t].replace(/%([\d]+)/g,(t,e)=>i[parseInt(e,10)]):t};function E(){let e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e3;return new Promise(t=>{setTimeout(()=>{t(!0)},e)})}const C=t=>{let{type:e,text:s,html:i,id:n}=t;const a={success:()=>a,error:()=>a,warning:()=>a,info:()=>a,view:()=>a};try{var r;let t;if(e)switch(e){case"joiningSteamGroup":case"leavingSteamGroup":case"gettingSteamGroupId":t=$(`<li>${G(e)}<a href="https://steamcommunity.com/groups/${s}" target="_blank">${s}</a>...<font></font></li>`);break;case"subscribingForum":case"unsubscribingForum":case"gettingForumId":t=$(`<li>${G(e)}<a href="https://steamcommunity.com/app/${s}/discussions/" target="_blank">${s}</a>...<font></font></li>`);break;case"followingCurator":case"unfollowingCurator":case"getCuratorId":t=$(`<li>${G(e)}<a href="https://store.steampowered.com/${null!==s&&void 0!==s&&s.includes("/")?s:`curator/${s}`}" target="_blank">${s}</a>...<font></font></li>`);break;case"addingToWishlist":case"removingFromWishlist":case"followingGame":case"unfollowingGame":t=$(`<li>${G(e)}<a href="https://store.steampowered.com/app/${s}" target="_blank">${s}</a>...<font></font></li>`);break;case"favoritingWorkshop":case"unfavoritingWorkshop":case"gettingWorkshopAppId":case"votingUpWorkshop":t=$(`<li>${G(e)}<a href="https://steamcommunity.com/sharedfiles/filedetails/?id=${s}" target="_blank">
      ${s}</a>...<font></font></li>`);break;case"gettingAnnouncementParams":case"likingAnnouncement":t=$(`<li>${G(e)}<a href="https://store.steampowered.com/news/app/${s}/view/${n}" target="_blank">
      ${n}</a>...<font></font></li>`);break;case"joiningDiscordServer":case"gettingDiscordGuild":t=$(`<li>${G(e)}<a href="https://discord.com/invite/${s}" target="_blank">${s}</a>...<font></font></li>`);break;case"leavingDiscordServer":t=$(`<li>${G(e)}<a href="https://discord.com/channels/@me/${s}" target="_blank">${s}</a>...<font></font></li>`);break;case"updateDiscordAuth":t=$(`<li style="color:red;">${G("updateDiscordAuth")}</li>`);break;case"followingTwitchChannel":case"unfollowingTwitchChannel":case"gettingTwitchChannelId":t=$(`<li>${G(e)}<a href="https://www.twitch.tv/${s}" target="_blank">${s}</a>...<font></font></li>`);break;case"gettingInsUserId":case"followingIns":case"unfollowingIns":t=$(`<li>${G(e)}<a href="https://www.instagram.com/${s}/" target="_blank">${s}</a>...<font></font></li>`);break;case"gettingTwitterUserId":case"followingTwitterUser":case"unfollowingTwitterUser":t=$(`<li>${G(e)}<a href="https://twitter.com/${s}" target="_blank">${s}</a>...<font></font></li>`);break;case"retweetting":case"unretweetting":t=$(`<li>${G(e)}${s}...<font></font></li>`);break;case"joiningReddit":case"leavingReddit":t=$(`<li>${G(e)}<a href="https://www.reddit.com/r/${s}/" target="_blank">${s}</a>...<font></font></li>`);break;case"followingRedditUser":case"unfollowingRedditUser":t=$(`<li>${G(e)}<a href="https://www.reddit.com/user/${null===s||void 0===s?void 0:s.replace("u_","")}" target="_blank">
      ${null===s||void 0===s?void 0:s.replace("u_","")}</a>...<font></font></li>`);break;case"followingYtbChannel":case"unfollowingYtbChannel":t=$(`<li>${G(e)}<a href="https://www.youtube.com/channel/${s}" target="_blank">${s}</a>...<font></font></li>`);break;case"likingYtbVideo":case"unlikingYtbVideo":t=$(`<li>${G(e)}<a href="https://www.youtube.com/watch?v=${s}" target="_blank">${s}</a>...<font></font></li>`);break;case"gettingVkId":case"joiningVkGroup":case"leavingVkGroup":case"joiningVkPublic":case"leavingVkPublic":case"sendingVkWall":case"deletingVkWall":t=$(`<li>${G(e)}<a href="https://vk.com/${s}/" target="_blank">${s}</a>...<font></font></li>`);break;case"visitLink":t=$(`<li>${G("visitLink")}<a href="${s}" target="_blank">${s}</a>...<font></font></li>`);break;case"verifyingInsAuth":case"text":t=$(`<li>${G(s)}<font></font></li>`);break;case"html":t=$(s||i);break;case"whiteList":t=$(`<li><font class="warning">${G("skipTask")}[${s}(${n})](${G("whiteList")})</font></li>`);break;default:t=$(`<li>${G("unKnown")}:${e}(${s})...<font></font></li>`)}else if(s)t=$(`<li>${G(s)}<font></font></li>`);else{if(!i)return a;t=$(i)}return t.addClass("card-text"),$("#auto-task-info").append(t),null!==(r=t[0])&&void 0!==r&&r.scrollIntoView(),{font:t.find("font"),success(){var t,e,s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Success",i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return null!==(t=this.font)&&void 0!==t&&t.attr("class","").addClass("success"),i?null!==(e=this.font)&&void 0!==e&&e.html(s):null!==(e=this.font)&&void 0!==e&&e.text(s),this},error(){var t,e,s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Error",i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return null!==(t=this.font)&&void 0!==t&&t.attr("class","").addClass("error"),i?null!==(e=this.font)&&void 0!==e&&e.html(s):null!==(e=this.font)&&void 0!==e&&e.text(s),this},warning(){var t,e,s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Warning",i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return null!==(t=this.font)&&void 0!==t&&t.attr("class","").addClass("warning"),i?null!==(e=this.font)&&void 0!==e&&e.html(s):null!==(e=this.font)&&void 0!==e&&e.text(s),this},info(){var t,e,s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Info",i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return null!==(t=this.font)&&void 0!==t&&t.attr("class","").addClass("info"),i?null!==(e=this.font)&&void 0!==e&&e.html(s):null!==(e=this.font)&&void 0!==e&&e.text(s),this},view(){var t;return null!==(t=this.font)&&void 0!==t&&t[0].scrollIntoView(),this}}}catch(t){return A(t,"echoLog"),a}},I=t=>{try{return[...new Set(t)]}catch(t){return A(t,"unique"),[]}},u=async e=>{try{if(!e)return null;const s=GM_getValue("redirectLinks")||{};return s[e]&&s[e],S({url:e,method:"GET"}).then(t=>{var t=t["data"];return null!=t&&t.finalUrl?(s[e]=t.finalUrl,GM_setValue("redirectLinks",s),t.finalUrl):null})}catch(t){return A(t,"getRedirectLink"),null}},r=async(t,e)=>{try{const i=C({type:"visitLink",text:t});return S({url:t,method:"GET",...e}).then(t=>{var{result:e,statusText:s,status:t}=t;return"Success"===e?(i.success(),!0):(i.error(`${e}:${s}(${t})`),!1)})}catch(t){return A(t,"visitLink"),!1}};t=class{constructor(){var t,e,s;s=void 0,(e="tasks")in(t=this)?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}getRealParams(e,s,i,n){try{let t=[];return 0<s.length&&(t=[...t,...s.map(t=>n(t)).filter(t=>t)]),!i&&0<this.tasks[e].length&&(t=[...t,...this.tasks[e]]),I(t)}catch(t){return A(t,"Social.getRealParams"),[]}}};function e(t,e){l(t,e),e.add(t)}function s(t,e,s){l(t,e),e.set(t,s)}function l(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function c(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function h(t,e,s){return function(t,e,s){if(e.set)e.set.call(t,s);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=s}}(t,p(t,e,"set"),s),s}function f(t,e,s){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return s}function w(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,p(t,e,"get"))}function p(t,e,s){if(!e.has(t))throw new TypeError("attempted to "+s+" private field on non-instance");return e.get(t)}const m={servers:[]};var v=new WeakMap,g=new WeakMap,k=new WeakMap,y=new WeakSet,T=new WeakSet,b=new WeakSet,x=new WeakSet,L=new WeakSet,_=new WeakSet;(class extends t{});async function P(){try{const n=C({text:G("verifyingAuth","Discord")});var{result:t,statusText:e,status:s,data:i}=await S({url:"https://discord.com/api/v6/users/@me",method:"HEAD",headers:{authorization:w(this,v).auth}});return"Success"===t?200===(null==i?void 0:i.status)?(n.success(),!0):(n.error(`Error:${null==i?void 0:i.statusText}(${null==i?void 0:i.status})`),!1):(n.error(`${t}:${e}(${s})`),!1)}catch(t){return A(t,"Discord.verifyAuth"),!1}}async function W(){try{const s=C({text:G("updatingAuth","Discord")});return new Promise(e=>{const t=GM_openInTab("https://discord.com/channels/@me#auth",{active:!0,insert:!0,setParent:!0});t.onclose=async()=>{var t=null===(t=GM_getValue("discordAuth"))||void 0===t?void 0:t.auth;t?(h(this,v,{auth:t}),s.success(),e(await f(this,y,P).call(this))):(s.error("Error: Update discord auth failed!"),e(!1))}})}catch(t){return A(t,"Discord.updateAuth"),!1}}async function j(t){try{const l=C({type:"joiningDiscordServer",text:t});var e,s,{result:i,statusText:n,status:a,data:r}=await S({url:`https://discord.com/api/v6/invites/${t}`,method:"POST",dataType:"json",headers:{authorization:w(this,v).auth}});if("Success"!==i||200!==(null==r?void 0:r.status))return l.error(`${i}:${n}(${a})`),!1;l.success();var o=String(null===(e=r.response)||void 0===e||null===(s=e.guild)||void 0===s?void 0:s.id);return o&&(f(this,_,O).call(this,t,o),this.tasks.servers=I([...this.tasks.servers,t])),!0}catch(t){return A(t,"Discord.joinServer"),!1}}async function V(t){try{if(this.whiteList.servers.includes(t))return C({type:"whiteList",text:"Discord.leaveServer",id:t}),!0;var e=await f(this,L,M).call(this,t);if(!e)return!1;const r=C({type:"leavingDiscordServer",text:e});var{result:s,statusText:i,status:n,data:a}=await S({url:`https://discord.com/api/v6/users/@me/guilds/${e}`,method:"DELETE",headers:{authorization:w(this,v).auth}});return"Success"===s&&204===(null==a?void 0:a.status)?(r.success(),!0):(r.error(`${s}:${i}(${n})`),!1)}catch(t){return A(t,"Discord.leaveServer"),!1}}async function M(t){try{const n=C({type:"gettingDiscordGuild",text:t});var e=w(this,g)[t];if(e)return n.success(),e;const{result:a,statusText:r,status:o,data:l}=await S({url:`https://discord.com/invite/${t}`,method:"GET"});if("Success"!==a||200!==(null===l||void 0===l?void 0:l.status))return n.error(`${a}:${r}(${o})`),!1;var s,i=null===(s=l.responseText.match(/https?:\/\/cdn\.discordapp\.com\/icons\/([\d]+?)\//))||void 0===s?void 0:s[1];return i?(n.success(),f(this,_,O).call(this,t,i),i):(n.error(`${a}:${r}(${o})`),!1)}catch(t){return A(t,"Discord.getGuild"),!1}}function O(t,e){try{w(this,g)[t]=e,GM_setValue("discordCache",w(this,g))}catch(t){A(t,"Discord.setCache")}}const F=class extends t{constructor(){var t;super(...arguments),e(this,_),e(this,L),e(this,x),e(this,b),e(this,T),e(this,y),c(this,"tasks",{...m}),c(this,"whiteList",(null===(t=GM_getValue("whiteList"))||void 0===t?void 0:t.discord)||{...m}),s(this,v,{writable:!0,value:GM_getValue("discordAuth")||{}}),s(this,g,{writable:!0,value:GM_getValue("discordCache")||{}}),s(this,k,{writable:!0,value:!1})}async init(){try{return w(this,k)?!0:w(this,v).auth?await f(this,y,P).call(this)?(C({html:`<li><font class="success">${G("initSuccess","Discord")}</font></li>`}),h(this,k,!0),!0):(GM_setValue("discordAuth",{auth:null}),await f(this,T,W).call(this)?(C({html:`<li><font class="success">${G("initSuccess","Discord")}</font></li>`}),h(this,k,!0),!0):(C({html:`<li><font class="success">${G("initFailed","Discord")}</font></li>`}),!1)):!!await f(this,T,W).call(this)&&(h(this,k,!0),!0)}catch(t){return A(t,"Discord.init"),!1}}async toggle(t){var{doTask:e=!0,serverLinks:t=[]}=t;try{if(!w(this,k))return C({text:G("needInit")}),!1;const i=[];var s=this.getRealParams("servers",t,e,t=>{return null===(t=t.match(/invite\/(.+)/))||void 0===t?void 0:t[1]});if(0<s.length)for(const n of s)e?i.push(f(this,b,j).call(this,n)):i.push(f(this,x,V).call(this,n)),await E(1e3);return Promise.all(i).then(()=>!0)}catch(t){return A(t,"Discord.toggleServers"),!1}}};function D(t,e){R(t,e),e.add(t)}function U(t,e,s){R(t,e),e.set(t,s)}function R(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function q(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function z(t,e,s){return function(t,e,s){if(e.set)e.set.call(t,s);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=s}}(t,Y(t,e,"set"),s),s}function N(t,e,s){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return s}function K(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Y(t,e,"get"))}function Y(t,e,s){if(!e.has(t))throw new TypeError("attempted to "+s+" private field on non-instance");return e.get(t)}const B={users:[]};var H=new WeakMap,J=new WeakMap,Z=new WeakMap,Q=new WeakSet,X=new WeakSet,tt=new WeakSet,et=new WeakSet;(class extends t{});async function st(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"instagram";try{const l=C({type:"instagram"===t?"verifyingInsAuth":"gettingInsUserId",text:t});var e=K(this,H)[t];if(e&&"instagram"!==t)return l.success(),e;const{result:u,statusText:c,status:h,data:d}=await S({url:`https://www.instagram.com/${t}/`,method:"GET"});if("Success"!==u)return!1;if(null!==d&&void 0!==d&&d.finalUrl.includes("accounts/login"))return l.error(`Error:${G("loginIns")}`,!0),!1;if(null!==d&&void 0!==d&&d.finalUrl.includes("www.instagram.com/challenge"))return l.error(`Error:${G("insBanned")}`),!1;if(200!==(null===d||void 0===d?void 0:d.status))return l.error(`${u}:${c}(${h})`),!1;var s,i,n,a=null===(s=d.responseText.match(/"csrf_token":"(.+?)"/))||void 0===s?void 0:s[1],r=null===(i=d.responseText.match(/"rollout_hash":"(.+?)"/))||void 0===i?void 0:i[1];if("instagram"===t)return!(!a||!r)&&(z(this,J,{csrftoken:a,hash:r}),!0);var o=null===(n=d.responseText.match(/"profilePage_([\d]+?)"/))||void 0===n?void 0:n[1];return o?(N(this,et,at).call(this,t,o),l.success(),o):(l.error("Error: Get ins data error!"),!1)}catch(t){return A(t,"Instagram.getUserInfo"),!1}}async function it(t){try{var e=await N(this,Q,st).call(this,t);if(!e)return!1;const l=C({type:"followingIns",text:t});var s,i,{result:n,statusText:a,status:r,data:o}=await S({url:`https://www.instagram.com/web/friendships/${e}/follow/`,method:"POST",dataType:"json",headers:{"x-csrftoken":K(this,J).csrftoken,origin:"https://www.instagram.com",referer:`https://www.instagram.com/${t}/`,"content-type":"application/x-www-form-urlencoded","sec-fetch-site":"same-origin","x-instagram-ajax":K(this,J).hash}});return"Success"===n?200===(null==o?void 0:o.status)&&"following"===(null===(s=o.response)||void 0===s?void 0:s.result)?(l.success(),this.tasks.users=I([...this.tasks.users,t]),!0):(l.error(`Error:${(null==o||null===(i=o.response)||void 0===i?void 0:i.feedback_message)||`${null==o?void 0:o.statusText}(${null==o?void 0:o.status})`}`),!1):(l.error(`${n}:${a}(${r})`),!1)}catch(t){return A(t,"Instagram.followUser"),!1}}async function nt(t){try{if(this.whiteList.users.includes(t))return C({type:"whiteList",text:"Instagram.unfollowUser",id:t}),!0;var e=await N(this,Q,st).call(this,t);if(!e)return!1;const o=C({type:"unfollowingIns",text:t});var s,{result:i,statusText:n,status:a,data:r}=await S({url:`https://www.instagram.com/web/friendships/${e}/unfollow/`,method:"POST",dataType:"json",headers:{"x-csrftoken":K(this,J).csrftoken,origin:"https://www.instagram.com",referer:`https://www.instagram.com/${t}/`,"content-type":"application/x-www-form-urlencoded","sec-fetch-site":"same-origin","x-instagram-ajax":K(this,J).hash}});return"Success"===i?200===(null==r?void 0:r.status)&&"ok"===(null===(s=r.response)||void 0===s?void 0:s.status)?(o.success(),!0):(o.error(`Error:${null==r?void 0:r.statusText}(${null==r?void 0:r.status})`),!1):(o.error(`${i}:${n}(${a})`),!1)}catch(t){return A(t,"Instagram.unfollowUser"),!1}}function at(t,e){try{K(this,H)[t]=e,GM_setValue("instagramCache",K(this,H))}catch(t){A(t,"Instagram.setCache")}}const rt=class extends t{constructor(){var t;super(...arguments),D(this,et),D(this,tt),D(this,X),D(this,Q),q(this,"tasks",{...B}),q(this,"whiteList",(null===(t=GM_getValue("whiteList"))||void 0===t?void 0:t.instagram)||{...B}),U(this,H,{writable:!0,value:GM_getValue("instagramCache")||{}}),U(this,J,{writable:!0,value:{}}),U(this,Z,{writable:!0,value:!1})}async init(){try{return K(this,Z)?!0:await N(this,Q,st).call(this)?(C({html:`<li><font class="success">${G("initSuccess","Instagram")}</font></li>`}),z(this,Z,!0),!0):(C({html:`<li><font class="success">${G("initFailed","Instagram")}</font></li>`}),!1)}catch(t){return A(t,"Instagram.init"),!1}}async toggle(t){var{doTask:e=!0,userLinks:t=[]}=t;try{if(!K(this,Z))return C({text:G("needInit")}),!1;const i=[];var s=this.getRealParams("users",t,e,t=>{return null===(t=t.match(/https:\/\/www\.instagram\.com\/(.+)?\//))||void 0===t?void 0:t[1]});if(0<s.length)for(const n of s)e?i.push(N(this,X,it).call(this,n)):i.push(N(this,tt,nt).call(this,n)),await E(1e3);return Promise.all(i).then(()=>!0)}catch(t){return A(t,"Instagram.toggleUsers"),!1}}};function ot(t,e){ut(t,e),e.add(t)}function lt(t,e,s){ut(t,e),e.set(t,s)}function ut(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ct(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function ht(t,e,s){return function(t,e,s){if(e.set)e.set.call(t,s);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=s}}(t,wt(t,e,"set"),s),s}function dt(t,e,s){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return s}function ft(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,wt(t,e,"get"))}function wt(t,e,s){if(!e.has(t))throw new TypeError("attempted to "+s+" private field on non-instance");return e.get(t)}const pt={reddits:[]};var mt=new WeakMap,vt=new WeakMap,gt=new WeakSet,kt=new WeakSet;(class extends t{});async function yt(){try{const s=C({text:G("changingRedditVersion")});return GM_setValue("redditAuth",null),new Promise(t=>{const e=GM_openInTab("https://www.reddit.com/#auth",{active:!0,insert:!0,setParent:!0});e.onclose=async()=>{s.success(),t(await dt(this,kt,Tt).call(this,!0))}})}catch(t){return A(t,"Reddit.useBeta"),!1}}async function Tt(){var t,e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];try{const i=C({text:G("updatingAuth","Reddit")}),{result:n,statusText:a,status:r,data:o}=await S({url:"https://www.reddit.com/",method:"GET",nochche:!0,headers:{"Cache-Control":"no-cache"}});if("Success"!==n)return i.error(`${n}:${a}(${r})`),!1;if(null!==o&&void 0!==o&&o.responseText.includes("www.reddit.com/login/"))return i.error(`Error:${G("loginReddit")}`,!0),!1;if(200!==(null===o||void 0===o?void 0:o.status))return i.error(`Error:${null===o||void 0===o?void 0:o.statusText}(${null===o||void 0===o?void 0:o.status})`),!1;if(o.responseText.includes("redesign-beta-optin-btn")&&!e)return dt(this,gt,yt).call(this);var s=null===(t=o.responseText.match(/"accessToken":"(.*?)","expires":"(.*?)"/))||void 0===t?void 0:t[1];return s?(ht(this,mt,{token:s}),i.success(),!0):(i.error('Error: Parameter "accessToken" not found!'),!1)}catch(t){return A(t,"Reddit.updateAuth"),!1}}const $t=class extends t{constructor(){var t;super(...arguments),ot(this,kt),ot(this,gt),ct(this,"tasks",{...pt}),ct(this,"whiteList",(null===(t=GM_getValue("whiteList"))||void 0===t?void 0:t.reddit)||{...pt}),lt(this,mt,{writable:!0,value:void 0}),lt(this,vt,{writable:!0,value:!1})}async init(){try{return ft(this,vt)?!0:await dt(this,kt,Tt).call(this)?(C({html:`<li><font class="success">${G("initSuccess","Reddit")}</font></li>`}),ht(this,vt,!0),!0):(C({html:`<li><font class="success">${G("initFailed","Reddit")}</font></li>`}),!1)}catch(t){return A(t,"Reddit.init"),!1}}async toggleTask(e){var{name:s,doTask:e=!0}=e;try{if(!e&&this.whiteList.reddits.includes(s))return C({type:"whiteList",text:"Reddit.undoTask",id:s}),!0;let t=e?"joiningReddit":"leavingReddit";/^u_/.test(s)&&(t=e?"followingRedditUser":"unfollowingRedditUser");const o=C({type:t,text:s});var{result:i,statusText:n,status:a,data:r}=await S({url:"https://oauth.reddit.com/api/subscribe?redditWebClient=desktop2x&app=desktop2x-client-production&raw_json=1&gilding_detail=1",method:"POST",headers:{authorization:`Bearer ${ft(this,mt).token}`,"content-type":"application/x-www-form-urlencoded"},data:$.param({action:e?"sub":"unsub",sr_name:s,api_type:"json"})});return"Success"===i?200===(null==r?void 0:r.status)?(o.success(),e&&(this.tasks.reddits=I([...this.tasks.reddits,s])),!0):(o.error(`Error:${null==r?void 0:r.statusText}(${null==r?void 0:r.status})`),!1):(o.error(`${i}:${n}(${a})`),!1)}catch(t){return A(t,"Reddit.toggleTask"),!1}}async toggle(t){var{doTask:e=!0,redditLinks:t=[]}=t;try{if(!ft(this,vt))return C({text:G("needInit")}),!1;const i=[];var s=this.getRealParams("reddits",t,e,t=>{var e=null===(e=t.match(/https?:\/\/www\.reddit\.com\/r\/([^/]*)/))||void 0===e?void 0:e[1],t=null===(t=t.match(/https?:\/\/www\.reddit\.com\/user\/([^/]*)/))||void 0===t?void 0:t[1];return t?e||t:e});if(0<s.length)for(const n of s)i.push(this.toggleTask({name:n,doTask:e})),await E(1e3);return Promise.all(i).then(()=>!0)}catch(t){return A(t,"Reddit.toggle"),!1}}};function bt(t,e){Lt(t,e),e.add(t)}function xt(t,e,s){Lt(t,e),e.set(t,s)}function Lt(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function St(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function It(t,e,s){return function(t,e,s){if(e.set)e.set.call(t,s);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=s}}(t,Gt(t,e,"set"),s),s}function _t(t,e,s){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return s}function At(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Gt(t,e,"get"))}function Gt(t,e,s){if(!e.has(t))throw new TypeError("attempted to "+s+" private field on non-instance");return e.get(t)}const Et={channels:[]};var Ct=new WeakMap,Pt=new WeakMap,Wt=new WeakMap,jt=new WeakSet,Vt=new WeakSet,Mt=new WeakSet,Ot=new WeakSet,Ft=new WeakSet;(class extends t{});async function Dt(){try{const o=C({text:G("verifyingAuth","Twitch")});var t,e,s,{result:i,statusText:n,status:a,data:r}=await S({url:"https://gql.twitch.tv/gql",method:"POST",dataType:"json",headers:{Authorization:`OAuth ${At(this,Ct).authToken}`,"Client-Id":At(this,Ct).clientId},data:'[{"operationName":"FrontPageNew_User","variables":{"limit":1},"extensions":{"persistedQuery":{"version":1,"sha256Hash":"64bd07a2cbaca80699d62636d966cf6395a5d14a1f0a14282067dcb28b13eb11"}}}]'});return"Success"===i?200===(null==r?void 0:r.status)&&null!==(t=r.response)&&void 0!==t&&null!==(e=t[0])&&void 0!==e&&null!==(s=e.data)&&void 0!==s&&s.currentUser?(o.success(),!0):(o.error(`Error:${null==r?void 0:r.statusText}(${null==r?void 0:r.status})`),!1):(o.error(`${i}:${n}(${a})`),!1)}catch(t){return A(t,"Twitch.verifyAuth"),!1}}async function Ut(){try{const s=C({text:G("updatingAuth","Twitch")});return new Promise(e=>{const t=GM_openInTab("https://www.twitch.tv/#auth",{active:!0,insert:!0,setParent:!0});t.onclose=async()=>{var t=GM_getValue("twitchAuth");t?(It(this,Ct,t),s.success(),e(await _t(this,jt,Dt).call(this))):(s.error("Error: Update twitch auth failed!"),e(!1))}})}catch(t){return A(t,"Twitch.updateAuth"),!1}}async function Rt(t){var{name:e,doTask:t=!0}=t;try{if(!t&&this.whiteList.channels.includes(e))return C({type:"whiteList",text:"Twitch.unfollowChannel",id:e}),!0;var s=await _t(this,Ot,qt).call(this,e);if(!s)return!1;const u=C({type:`${t?"":"un"}followingTwitchChannel`,text:e});var i=`[{"operationName":"FollowButton_FollowUser","variables":{"input":{"disableNotifications":false,"targetID":"${s}`+'"}},"extensions":{"persistedQuery":{"version":1,"sha256Hash":"3efee1acda90efdff9fef6e6b4a29213be3ee490781c5b54469717b6131ffdfe"}}}]',n=`[{"operationName":"FollowButton_UnfollowUser","variables":{"input":{"targetID":"${s}"}},`+'"extensions":{"persistedQuery":{"version":1,"sha256Hash":"d7fbdb4e9780dcdc0cc1618ec783309471cd05a59584fc3c56ea1c52bb632d41"}}}]',{result:a,statusText:r,status:o,data:l}=await S({url:"https://gql.twitch.tv/gql",method:"POST",dataType:"json",headers:{Authorization:`OAuth ${At(this,Ct).authToken}`},data:t?i:n});return"Success"===a?200===(null==l?void 0:l.status)?(u.success(),t&&(this.tasks.channels=I([...this.tasks.channels,e])),!0):(u.error(`Error:${null==l?void 0:l.statusText}(${null==l?void 0:l.status})`),!1):(u.error(`${a}:${r}(${o})`),!1)}catch(t){return A(t,"Twitch.toggleChannel"),!1}}async function qt(t){try{const h=C({type:"gettingTwitchChannelId",text:t});var e=At(this,Pt)[t];if(e)return h.success(),e;var{result:s,statusText:i,status:n,data:a}=await S({url:"https://gql.twitch.tv/gql",method:"POST",headers:{Authorization:`OAuth ${At(this,Ct).authToken}`,"Client-Id":At(this,Ct).clientId},responseType:"json",data:`[{"operationName":"ActiveWatchParty","variables":{"channelLogin":"${t}"},`+'"extensions":{"persistedQuery":{"version":1,"sha256Hash":"4a8156c97b19e3a36e081cf6d6ddb5dbf9f9b02ae60e4d2ff26ed70aebc80a30"}}}]'});if("Success"!==s)return h.error(`${s}:${i}(${n})`),!1;if(200!==(null==a?void 0:a.status))return h.error(`Error:${null==a?void 0:a.statusText}(${null==a?void 0:a.status})`),!1;var r,o,l,u,c=String(null===(r=a.response)||void 0===r||null===(o=r[0])||void 0===o||null===(l=o.data)||void 0===l||null===(u=l.user)||void 0===u?void 0:u.id);return c?(_t(this,Ft,zt).call(this,t,c),h.success(),c):(h.error(`Error:${a.statusText}(${a.status})`),!1)}catch(t){return A(t,"Twitch.getChannelId"),!1}}function zt(t,e){try{At(this,Pt)[t]=e,GM_setValue("twitchCache",At(this,Pt))}catch(t){A(t,"Twitch.setCache")}}const Nt=class extends t{constructor(){var t;super(...arguments),bt(this,Ft),bt(this,Ot),bt(this,Mt),bt(this,Vt),bt(this,jt),St(this,"tasks",{...Et}),St(this,"whiteList",(null===(t=GM_getValue("whiteList"))||void 0===t?void 0:t.twitch)||{...Et}),xt(this,Ct,{writable:!0,value:GM_getValue("twitchAuth")||{}}),xt(this,Pt,{writable:!0,value:GM_getValue("twitchCache")||{}}),xt(this,Wt,{writable:!0,value:!1})}async init(){try{return At(this,Wt)?!0:At(this,Ct).authToken?await _t(this,jt,Dt).call(this)?(C({html:`<li><font class="success">${G("initSuccess","Twitch")}</font></li>`}),It(this,Wt,!0),!0):(GM_setValue("twitchAuth",null),await _t(this,Vt,Ut).call(this)?(C({html:`<li><font class="success">${G("initSuccess","Twitch")}</font></li>`}),It(this,Wt,!0),!0):(C({html:`<li><font class="success">${G("initFailed","Twitch")}</font></li>`}),!1)):!!await _t(this,Vt,Ut).call(this)&&(It(this,Wt,!0),!0)}catch(t){return A(t,"Twitch.init"),!1}}async toggle(t){var{doTask:e=!0,channelLinks:t=[]}=t;try{if(!At(this,Wt))return C({text:G("needInit")}),!1;const i=[];var s=this.getRealParams("channels",t,e,t=>{return null===(t=t.match(/https:\/\/(www\.)?twitch\.tv\/(.+)/))||void 0===t?void 0:t[2]});if(0<s.length)for(const n of s)i.push(_t(this,Mt,Rt).call(this,{name:n,doTask:e})),await E(1e3);return Promise.all(i).then(()=>!0)}catch(t){return A(t,"Twitch.toggle"),!1}}};function Kt(t,e){Bt(t,e),e.add(t)}function Yt(t,e,s){Bt(t,e),e.set(t,s)}function Bt(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Ht(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function Jt(t,e,s){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return s}function Zt(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Xt(t,e,"get"))}function Qt(t,e,s){return function(t,e,s){if(e.set)e.set.call(t,s);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=s}}(t,Xt(t,e,"set"),s),s}function Xt(t,e,s){if(!e.has(t))throw new TypeError("attempted to "+s+" private field on non-instance");return e.get(t)}const te={users:[],retweets:[],likes:[]};var ee=new WeakMap,se=new WeakMap,ie=new WeakMap,ne=new WeakMap,ae=new WeakSet,re=new WeakSet,oe=new WeakSet,le=new WeakSet,ue=new WeakSet,ce=new WeakSet;(class extends t{});async function he(){try{return Jt(this,oe,fe).call(this,{name:"verify",doTask:!0,verify:!0})}catch(t){return A(t,"Twitter.verifyAuth"),!1}}async function de(){try{const s=C({text:G("updatingAuth","Twitter")});return new Promise(e=>{const t=GM_openInTab("https://twitter.com/settings/account?k#auth",{active:!0,insert:!0,setParent:!0});t.onclose=async()=>{var t=GM_getValue("twitterAuth");t?(Qt(this,se,t),s.success(),e(await Jt(this,ae,he).call(this))):(s.error("Error: Update twitter auth failed!"),e(!1))}})}catch(t){return A(t,"Twitter.updateToken"),!1}}async function fe(t){var{name:e,doTask:s=!0,verify:t=!1}=t;try{if(!s&&!t&&this.whiteList.users.includes(e))return C({type:"whiteList",text:"Twitter.unfollowUser",id:e}),!0;var i=t?Zt(this,ee):await Jt(this,le,we).call(this,e);if(!i)return!1;const h=t?C({text:G("verifyingAuth","Twitter")}):C({type:`${s?"":"un"}followingTwitterUser`,text:e});var n,a,r,{result:o,statusText:l,status:u,data:c}=await S({url:`https://api.twitter.com/1.1/friendships/${s?"create":"destroy"}.json`,method:"POST",headers:{authorization:"Bearer AAAAAAAAAAAAAAAAAAAAANRILgAAAAAAnNwIzUejRCOuH5E6I8xnZz4puTs%3D1Zv7ttfk8LF81IUq16cHjhLTvJu4FA33AGWWjCpTnA","Content-Type":"application/x-www-form-urlencoded","x-csrf-token":Zt(this,se).ct0},responseType:"json",data:$.param({include_profile_interstitial_type:1,include_blocking:1,include_blocked_by:1,include_followed_by:1,include_want_retweets:1,include_mute_edge:1,include_can_dm:1,include_can_media_tag:1,skip_status:1,id:i})});return"Success"===o?200===(null==c?void 0:c.status)?(h.success(),s&&!t&&(this.tasks.users=I([...this.tasks.users,e])),!0):t&&403===(null==c?void 0:c.status)&&158===(null===(n=c.response)||void 0===n||null===(a=n.errors)||void 0===a||null===(r=a[0])||void 0===r?void 0:r.code)?(h.success(),!0):(h.error(`Error:${null==c?void 0:c.statusText}(${null==c?void 0:c.status})`),!1):(h.error(`${o}:${l}(${u})`),!1)}catch(t){return A(t,"Twitter.toggleUser"),!1}}async function we(t){try{const c=C({type:"gettingTwitterUserId",text:t});var e=Zt(this,ie)[t];if(e)return c.success(),e;var s,i,n,{result:a,statusText:r,status:o,data:l}=await S({url:"https://api.twitter.com/graphql/-xfUfZsnR_zqjFd-IfrN5A/UserByScreenName"+`?variables=%7B%22screen_name%22%3A%22${t}%22%2C%22withHighlightedLabel%22%3Atrue%7D`,method:"GET",headers:{authorization:"Bearer AAAAAAAAAAAAAAAAAAAAANRILgAAAAAAnNwIzUejRCOuH5E6I8xnZz4puTs%3D1Zv7ttfk8LF81IUq16cHjhLTvJu4FA33AGWWjCpTnA","content-type":"application/json"},responseType:"json",anonymous:!0});if("Success"!==a)return c.error(`${a}:${r}(${o})`),!1;if(200!==(null==l?void 0:l.status))return c.error(`Error:${null==l?void 0:l.statusText}(${null==l?void 0:l.status})`),!1;{let e=l.response||("object"==typeof l.responseText?l.responseText:null);if(!e)try{e=JSON.parse(l.responseText)}catch(t){e=null}var u=String(null===(s=e)||void 0===s||null===(i=s.data)||void 0===i||null===(n=i.user)||void 0===n?void 0:n.rest_id);return u?(Jt(this,ce,me).call(this,t,u),c.success(),u):(c.error(`Error:${l.statusText}(${l.status})`),!1)}}catch(t){return A(t,"Twitter.getUserId"),!1}}async function pe(t){var{retweetId:e,doTask:t=!0}=t;try{if(!t&&this.whiteList.retweets.includes(e))return C({type:"whiteList",text:"Twitter.unretweet",id:e}),!0;const u=C({type:`${t?"":"un"}retweetting`,text:e});var s,i,n,{result:a,statusText:r,status:o,data:l}=await S({url:`https://api.twitter.com/1.1/statuses/${t?"":"un"}retweet.json`,method:"POST",headers:{authorization:"Bearer AAAAAAAAAAAAAAAAAAAAANRILgAAAAAAnNwIzUejRCOuH5E6I8xnZz4puTs%3D1Zv7ttfk8LF81IUq16cHjhLTvJu4FA33AGWWjCpTnA","Content-Type":"application/x-www-form-urlencoded","x-csrf-token":Zt(this,se).ct0},data:$.param({tweet_mode:"extended",id:e}),responseType:"json"});return"Success"===a?200===(null==l?void 0:l.status)||403===(null==l?void 0:l.status)&&327===(null===(s=l.response)||void 0===s||null===(i=s.errors)||void 0===i||null===(n=i[0])||void 0===n?void 0:n.code)?(u.success(),t&&(this.tasks.retweets=I([...this.tasks.retweets,e])),!0):(u.error(`Error:${null==l?void 0:l.statusText}(${null==l?void 0:l.status})`),!1):(u.error(`${a}:${r}(${o})`),!1)}catch(t){return A(t,"Twitter.toggleRetweet"),!1}}function me(t,e){try{Zt(this,ie)[t]=e,GM_setValue("twitterCache",Zt(this,ie))}catch(t){A(t,"Twitter.setCache")}}const ve=class extends t{constructor(t){var e;super(),Kt(this,ce),Kt(this,ue),Kt(this,le),Kt(this,oe),Kt(this,re),Kt(this,ae),Ht(this,"tasks",{...te}),Ht(this,"whiteList",(null===(e=GM_getValue("whiteList"))||void 0===e?void 0:e.twitter)||{...te}),Yt(this,ee,{writable:!0,value:"783214"}),Yt(this,se,{writable:!0,value:GM_getValue("twitterAuth")||{}}),Yt(this,ie,{writable:!0,value:GM_getValue("twitterCache")||{}}),Yt(this,ne,{writable:!0,value:!1}),t&&Qt(this,ee,t)}async init(){try{return Zt(this,ne)?!0:Zt(this,se).ct0?await Jt(this,ae,he).call(this)?(C({html:`<li><font class="success">${G("initSuccess","Twitter")}</font></li>`}),Qt(this,ne,!0),!0):(GM_setValue("twitterAuth",null),await Jt(this,re,de).call(this)?(C({html:`<li><font class="success">${G("initSuccess","Twitter")}</font></li>`}),Qt(this,ne,!0),!0):(C({html:`<li><font class="success">${G("initFailed","Twitter")}</font></li>`}),!1)):!!await Jt(this,re,de).call(this)&&(Qt(this,ne,!0),!0)}catch(t){return A(t,"Twitter.init"),!1}}async toggle(t){var{doTask:e=!0,userLinks:s=[],retweetLinks:t=[]}=t;try{if(!Zt(this,ne))return C({text:G("needInit")}),!1;const a=[];var i=this.getRealParams("users",s,e,t=>{return null===(t=t.match(/https:\/\/twitter\.com\/(.+)/))||void 0===t?void 0:t[1]}),n=this.getRealParams("retweets",t,e,t=>{return null===(t=t.match(/https:\/\/twitter\.com\/.*?\/status\/([\d]+)/))||void 0===t?void 0:t[1]});if(0<i.length)for(const r of i)a.push(Jt(this,oe,fe).call(this,{name:r,doTask:e})),await E(1e3);if(0<n.length)for(const o of n)a.push(Jt(this,ue,pe).call(this,{retweetId:o,doTask:e})),await E(1e3);return Promise.all(a).then(()=>!0)}catch(t){return A(t,"Twitter.toggle"),!1}}};function ge(t,e){ye(t,e),e.add(t)}function ke(t,e,s){ye(t,e),e.set(t,s)}function ye(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Te(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function $e(t,e,s){return function(t,e,s){if(e.set)e.set.call(t,s);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=s}}(t,Le(t,e,"set"),s),s}function be(t,e,s){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return s}function xe(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Le(t,e,"get"))}function Le(t,e,s){if(!e.has(t))throw new TypeError("attempted to "+s+" private field on non-instance");return e.get(t)}const Se={names:[]};var Ie=new WeakMap,_e=new WeakMap,Ae=new WeakMap,Ge=new WeakSet,Ee=new WeakSet,Ce=new WeakSet,Pe=new WeakSet,We=new WeakSet,je=new WeakSet,Ve=new WeakSet,Me=new WeakSet;(class extends t{});async function Oe(){try{const e=C({text:G("verifyAuth","Vk")}),{result:s,statusText:i,status:n,data:a}=await S({url:"https://vk.com/im",method:"GET"});var t;return"Success"===s?null!==a&&void 0!==a&&a.finalUrl.includes("vk.com/login")?(e.error(`Error:${G("loginVk")}`,!0),!1):200===(null===a||void 0===a?void 0:a.status)?($e(this,Ie,(null===(t=a.responseText.match(/TopNavBtn__profileLink" href="\/(.*?)"/))||void 0===t?void 0:t[1])||""),e.success(),!0):(e.error(`Error:${null===a||void 0===a?void 0:a.statusText}(${null===a||void 0===a?void 0:a.status})`),!1):(e.error(`${s}:${i}(${n})`),!1)}catch(t){return A(t,"Vk.verifyAuth"),!1}}async function Fe(t,e){var s=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];try{const o=C({type:s?"joiningVkGroup":"leavingVkGroup",text:t});if("enter"===e.groupAct&&!s||"leave"===e.groupAct&&s)return o.success(),!0;const l={act:s?"enter":"leave",al:1,gid:e.groupId,hash:e.groupHash};s&&(l.context="_");var{result:i,statusText:n,status:a,data:r}=await S({url:"https://vk.com/al_groups.php",method:"POST",headers:{origin:"https://vk.com",referer:`https://vk.com/${t}`,"content-type":"application/x-www-form-urlencoded"},data:$.param(l)});return"Success"===i?200===(null==r?void 0:r.status)?(o.success(),s&&(this.tasks.names=I([...this.tasks.names,t])),!0):(o.error(`Error:${null==r?void 0:r.statusText}(${null==r?void 0:r.status})`),!1):(o.error(`${i}:${n}(${a})`),!1)}catch(t){return A(t,"Vk.toggleGroup"),!1}}async function De(t,e){var s=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];try{const o=C({type:s?"joiningVkPublic":"leaveingVkPublic",text:t});if(e.publicJoined&&s||!e.publicJoined&&!s)return o.success(),!0;var{result:i,statusText:n,status:a,data:r}=await S({url:"https://vk.com/al_public.php",method:"POST",headers:{origin:"https://vk.com",referer:`https://vk.com/${t}`,"content-type":"application/x-www-form-urlencoded"},data:$.param({act:s?"a_enter":"a_leave",al:1,pid:e.publicPid,hash:e.publicHash})});return"Success"===i?200===(null==r?void 0:r.status)?(o.success(),s&&(this.tasks.names=I([...this.tasks.names,t])),!0):(o.error(`Error:${null==r?void 0:r.statusText}(${null==r?void 0:r.status})`),!1):(o.error(`${i}:${n}(${a})`),!1)}catch(t){return A(t,"Vk.togglePublic"),!1}}async function Ue(t){try{const y=C({type:"sendingVkWall",text:t}),{result:T,statusText:b,status:x,data:L}=await S({url:"https://vk.com/like.php",method:"POST",headers:{origin:"https://vk.com",referer:`https://vk.com/${t}`,"content-type":"application/x-www-form-urlencoded"},data:$.param({act:"publish_box",al:1,object:t})});if("Success"!==T)return y.error(`${T}:${b}(${x})`),!1;if(200!==(null===L||void 0===L?void 0:L.status))return y.error(`Error:${null===L||void 0===L?void 0:L.statusText}(${null===L||void 0===L?void 0:L.status})`),!1;var e,s=null===(e=L.responseText.match(/shHash:[\s]*'(.*?)'/))||void 0===e?void 0:e[1];if(s){var{result:i,statusText:n,status:a,data:r}=await S({url:"https://vk.com/like.php",method:"POST",headers:{origin:"https://vk.com",referer:`https://vk.com/${t}`,"content-type":"application/x-www-form-urlencoded"},data:$.param({Message:"",act:"a_do_publish",al:1,close_comments:0,friends_only:0,from:"box",hash:s,list:"",mark_as_ads:0,mute_notifications:0,object:t,ret_data:1,to:0})});if("Success"!==i)return y.error(`${i}:${n}(${a})`),!1;if(200===(null==r?void 0:r.status)){var o,l,u,c,h,d,f,w,p,m,v=JSON.parse((null===(o=r.responseText)||void 0===o?void 0:o.replace("\x3c!--",""))||"{}");if(!0===(null==v||null===(l=v.payload)||void 0===l||null===(u=l[1])||void 0===u||null===(c=u[1])||void 0===c?void 0:c.share_my)){y.success();var g=String(null==v||null===(h=v.payload)||void 0===h||null===(d=h[1])||void 0===d||null===(f=d[1])||void 0===f?void 0:f.post_id),k=String(null==v||null===(w=v.payload)||void 0===w||null===(p=w[1])||void 0===p||null===(m=p[1])||void 0===m?void 0:m.owner_id);return g&&k&&be(this,Me,Ne).call(this,t,`${k}_${g}`),this.tasks.names=I([...this.tasks.names,t]),!0}}return y.error(`Error:${null==r?void 0:r.statusText}(${null==r?void 0:r.status})`),!1}return y.error('Error: Get "hash" failed'),!1}catch(t){return A(t,"Vk.sendWall"),!1}}async function Re(t,e){try{const c=C({type:"deletingVkWall",text:t});var{result:s,statusText:i,status:n,data:a}=await S({url:"https://vk.com/al_wall.php?act=delete",method:"POST",headers:{origin:"https://vk.com",referer:`https://vk.com/${xe(this,Ie)}?w=wall${xe(this,_e)[t]}%2Fall`,"content-type":"application/x-www-form-urlencoded"},data:$.param({act:"delete",al:1,confirm:0,from:"wkview",hash:e.wallHash,post:xe(this,_e)[t]})});if("Success"!==s)return c.error(`${s}:${i}(${n})`),!1;if(200!==(null==a?void 0:a.status))return c.error(`Error:${null==a?void 0:a.statusText}(${null==a?void 0:a.status})`),!1;var r,o,l,u=JSON.parse((null===(r=a.responseText)||void 0===r?void 0:r.replace("\x3c!--",""))||"{}");return null!=u&&null!==(o=u.payload)&&void 0!==o&&null!==(l=o[1])&&void 0!==l&&l[1]?(c.success(),!0):(c.error(`Error:${null==a?void 0:a.statusText}(${null==a?void 0:a.status})`),!1)}catch(t){return A(t,"Vk.deleteWall"),!1}}async function qe(e,s){try{let t=`https://vk.com/${e}`;if(/^wall-/.test(e)){if(s)return{type:"sendWall"};if(!xe(this,_e)[e])return{type:"unSupport"};t=`https://vk.com/${xe(this,Ie)}?w=wall${xe(this,_e)[e]}`}const f=C({type:"gettingVkId",text:e}),{result:w,statusText:p,status:m,data:v}=await S({url:t,method:"GET"});if("Success"!==w)return f.error(`${w}:${p}(${m})`),!1;if(200!==(null===v||void 0===v?void 0:v.status))return f.error(`Error:${null===v||void 0===v?void 0:v.statusText}(${null===v||void 0===v?void 0:v.status})`),!1;var i,n,[,a,r,o]=v.responseText.match(/Groups.(enter|leave)\(.*?,.*?([\d]+?), '(.*?)'/)||[],l=null===(i=v.responseText.match(/"enterHash":"(.*?)"/))||void 0===i?void 0:i[1],u=null===(n=v.responseText.match(/"public_id":([\d]+?),/))||void 0===n?void 0:n[1],c=!v.responseText.includes("Public.subscribe");if(a&&r&&o)return f.success(),{groupAct:a,groupId:r,groupHash:o,type:"group"};if(l&&u)return f.success(),{publicHash:l,publicPid:u,publicJoined:c,type:"public"};if(v.responseText.includes("wall.deletePost")&&!s){var h,d=null===(h=v.responseText.match(/wall\.deletePost\(this, '.*?', '(.*?)'\)/))||void 0===h?void 0:h[1];if(d)return f.success(),{type:"deleteWall",wallHash:d}}else if(e.includes("wall")&&s)return f.success(),{type:"sendWall"};return f.error("Error: Parameters not found!"),!1}catch(t){return A(t,"Vk.getId"),!1}}async function ze(t){let{name:e,doTask:s=!0}=t;try{if(!s&&this.whiteList.names.includes(e))return C({type:"whiteList",text:"Vk.undoTask",id:e}),!0;var i=e.replace(/\/$/,""),n=await be(this,je,qe).call(this,i,s);if(!n)return!1;switch(n.type){case"group":return be(this,Ee,Fe).call(this,i,n,s);case"public":return be(this,Ce,De).call(this,i,n,s);case"sendWall":return!s||await be(this,Pe,Ue).call(this,i);case"deleteWall":return!!s||await be(this,We,Re).call(this,i,n);default:return!1}}catch(t){return A(t,"Vk.toggleVk"),!1}}function Ne(t,e){try{xe(this,_e)[t]=e,GM_setValue("vkCache",xe(this,_e))}catch(t){A(t,"Vk.setCache")}}const Ke=class extends t{constructor(){var t;super(...arguments),ge(this,Me),ge(this,Ve),ge(this,je),ge(this,We),ge(this,Pe),ge(this,Ce),ge(this,Ee),ge(this,Ge),Te(this,"tasks",{...Se}),Te(this,"whiteList",(null===(t=GM_getValue("whiteList"))||void 0===t?void 0:t.vk)||{...Se}),ke(this,Ie,{writable:!0,value:""}),ke(this,_e,{writable:!0,value:GM_getValue("vkCache")||{}}),ke(this,Ae,{writable:!0,value:!1})}async init(){try{return xe(this,Ae)?!0:await be(this,Ge,Oe).call(this)?(C({html:`<li><font class="success">${G("initSuccess","Vk")}</font></li>`}),$e(this,Ae,!0),!0):(C({html:`<li><font class="success">${G("initFailed","Vk")}</font></li>`}),!1)}catch(t){return A(t,"Vk.init"),!1}}async toggle(t){var{doTask:e=!0,nameLinks:t=[]}=t;try{if(!xe(this,Ae))return C({text:G("needInit")}),!1;const i=[];var s=this.getRealParams("names",t,e,t=>{return null===(t=t.match(/https:\/\/vk\.com\/([^/]+)/))||void 0===t?void 0:t[1]});if(0<s.length)for(const n of s)i.push(be(this,Ve,ze).call(this,{name:n,doTask:e})),await E(1e3);return Promise.all(i).then(()=>!0)}catch(t){return A(t,"Vk.toggle"),!1}}};function Ye(t,e){He(t,e),e.add(t)}function Be(t,e,s){He(t,e),e.set(t,s)}function He(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Je(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function Ze(t,e,s){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return s}function Qe(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ts(t,e,"get"))}function Xe(t,e,s){return function(t,e,s){if(e.set)e.set.call(t,s);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=s}}(t,ts(t,e,"set"),s),s}function ts(t,e,s){if(!e.has(t))throw new TypeError("attempted to "+s+" private field on non-instance");return e.get(t)}const es={channels:[],likes:[]},ss=async function(t,e){try{const d=C({text:G("gettingYtbToken")}),{result:f,statusText:w,status:p,data:m}=await S({url:t,method:"GET"});if("Success"!==f)return d.error(`${f}:${w}(${p})`),{};if(200!==(null===m||void 0===m?void 0:m.status))return d.error(`Error:${null===m||void 0===m?void 0:m.statusText}(${null===m||void 0===m?void 0:m.status})`),{};{var s,i;if(m.responseText.includes("accounts.google.com/ServiceLogin?service=youtube"))return d.error(`Error:${G("loginYtb")}`,!0),{needLogin:!0};var n=null===(s=m.responseText.match(/"INNERTUBE_API_KEY":"(.*?)"/))||void 0===s?void 0:s[1],a=(null===(i=m.responseText.match(/\(\{"INNERTUBE_CONTEXT":([\w\W]*?)\}\)/)||m.responseText.match(/"INNERTUBE_CONTEXT":([\w\W]*?\}),"INNERTUBE/))||void 0===i?void 0:i[1])||"{}";const{client:v,request:g}=JSON.parse(a);if(n&&v&&g){if(v.hl="en","channel"===e){var r,o=null===(r=m.responseText.match(/<meta itemprop="channelId" content="(.+?)">/))||void 0===r?void 0:r[1];return o?(d.success(),{params:{apiKey:n,client:v,request:g,channelId:o}}):(d.error('Error: Get "channelId" failed!'),{})}if("likeVideo"!==e)return d.error("Error: Unknown type"),{};var l,u,c=null===(l=m.responseText.match(/<link rel="shortlinkUrl" href="https:\/\/youtu\.be\/(.*?)">/))||void 0===l?void 0:l[1],h=null===(u=m.responseText.match(/"likeParams":"(.*?)"/))||void 0===u?void 0:u[1];return c?(d.success(),{params:{apiKey:n,client:v,request:g,videoId:c,likeParams:h}}):(d.error('Error: Get "videoId" failed!'),{})}return d.error('Error: Parameter "apiKey" not found!'),{}}}catch(t){return A(t,"Youtube.getInfo"),{}}};var is=new WeakMap,ns=new WeakMap,as=new WeakMap,rs=new WeakSet,os=new WeakSet,ls=new WeakSet,us=new WeakSet,cs=new WeakSet;class hs extends t{constructor(t){var e;super(),Ye(this,cs),Ye(this,us),Ye(this,ls),Ye(this,os),Ye(this,rs),Je(this,"tasks",{...es}),Je(this,"whiteList",(null===(e=GM_getValue("whiteList"))||void 0===e?void 0:e.youtube)||{...es}),Be(this,is,{writable:!0,value:GM_getValue("youtubeAuth")||{}}),Be(this,ns,{writable:!0,value:!1}),Be(this,as,{writable:!0,value:"https://www.youtube.com/channel/UCrXUsMBcfTVqwAS7DKg9C0Q"}),t&&Xe(this,as,t)}async init(){try{return Qe(this,ns)?!0:Qe(this,is).PAPISID?await Ze(this,rs,ds).call(this)?(C({html:`<li><font class="success">${G("initSuccess","Youtube")}</font></li>`}),Xe(this,ns,!0),!0):(GM_setValue("youtubeAuth",null),await Ze(this,os,fs).call(this)?(C({html:`<li><font class="success">${G("initSuccess","Youtube")}</font></li>`}),Xe(this,ns,!0),!0):(C({html:`<li><font class="success">${G("initFailed","Youtube")}</font></li>`}),!1)):!!await Ze(this,os,fs).call(this)&&(Xe(this,ns,!0),!0)}catch(t){return A(t,"Youtube.init"),!1}}async toggle(t){var{doTask:e=!0,channelLinks:s=[],videoLinks:t=[]}=t;try{if(!Qe(this,ns))return C({text:G("needInit")}),!1;const a=[];var i=this.getRealParams("channels",s,e,t=>{var e;return/^https:\/\/(www\.)?google\.com.*?\/url\?.*?url=https:\/\/www.youtube.com\/.*/.test(t)?null===(e=t.match(/url=(https:\/\/www.youtube.com\/.*)/))||void 0===e?void 0:e[1]:t}),n=this.getRealParams("likes",t,e,t=>{var e;return/^https:\/\/(www\.)?google\.com.*?\/url\?.*?url=https:\/\/www.youtube.com\/.*/.test(t)?null===(e=t.match(/url=(https:\/\/www.youtube.com\/.*)/))||void 0===e?void 0:e[1]:t});if(0<i.length)for(const r of i)a.push(Ze(this,us,ps).call(this,{link:r,doTask:e})),await E(1e3);if(0<n.length)for(const o of n)a.push(Ze(this,cs,ms).call(this,{link:o,doTask:e})),await E(1e3);return Promise.all(a).then(()=>!0)}catch(t){return A(t,"Youtube.toggle"),!1}}}async function ds(){try{return Ze(this,us,ps).call(this,{link:Qe(this,as),doTask:!0,verify:!0})}catch(t){return A(t,"Youtube.verifyAuth"),!1}}async function fs(){try{const s=C({text:G("updatingAuth","Youtube")});return new Promise(e=>{const t=GM_openInTab("https://www.youtube.com/#auth",{active:!0,insert:!0,setParent:!0});t.onclose=async()=>{var t=GM_getValue("youtubeAuth");t?(Xe(this,is,t),s.success(),Ze(this,rs,ds).call(this).then(t=>{e(t)})):(s.error("Error: Update youtube auth failed!"),e(!1))}})}catch(t){return A(t,"Discord.updateAuth"),!1}}function ws(t,e){return ss(t,e)}async function ps(t){var{link:e,doTask:s=!0,verify:t=!1}=t;try{var{params:i,needLogin:n}=await Ze(this,ls,ws).call(this,e,"channel"),{apiKey:a,client:r,request:o,channelId:l}=i||{};if(n)return C({html:G("loginYtb")}),!1;if(!(a&&r&&o&&l))return C({text:'"getYtbToken" failed'}),!1;if(!s&&!t&&this.whiteList.channels.includes(l))return C({type:"whiteList",text:"Youtube.unfollowChannel",id:l}),!0;const c=t?C({text:G("verifyingAuth","Youtube")}):C({type:s?"followingYtbChannel":"unfollowingYtbChannel",text:l});var u=parseInt(String((new Date).getTime()/1e3),10);const{result:h,statusText:d,status:f,data:w}=await S({url:`https://www.youtube.com/youtubei/v1/subscription/${s?"":"un"}subscribe?key=${a}`,method:"POST",headers:{origin:"https://www.youtube.com",referer:`https://www.youtube.com/channel/${l}`,"content-type":"application/json","x-goog-authuser":"0","x-goog-visitor-id":null==r?void 0:r.visitorData,"x-origin":"https://www.youtube.com",authorization:`SAPISIDHASH ${u}_${sha1(`${u} ${Qe(this,is).PAPISID} https://www.youtube.com`)}`},data:JSON.stringify({context:{client:r,request:{sessionId:null==o?void 0:o.sessionId,internalExperimentFlags:[],consistencyTokenJars:[]},user:{}},channelIds:[l],params:s?"EgIIAhgA":"CgIIAhgA"})});return"Success"===h?200===(null===w||void 0===w?void 0:w.status)?s&&(/"subscribed": true/.test(w.responseText)||w.responseText.includes("The subscription already exists"))||!s&&/"subscribed": false/.test(w.responseText)?(c.success(),s&&!t&&(this.tasks.channels=I([...this.tasks.channels,e])),!0):(c.error(G("tryUpdateYtbAuth"),!0),!1):(c.error(`Error:${null===w||void 0===w?void 0:w.statusText}(${null===w||void 0===w?void 0:w.status})`),!1):(c.error(`${h}:${d}(${f})`),!1)}catch(t){return A(t,"Youtube.toggleChannel"),!1}}async function ms(t){var{link:e,doTask:t=!0}=t;try{var{params:s,needLogin:i}=await Ze(this,ls,ws).call(this,e,"likeVideo"),{apiKey:n,client:a,request:r,videoId:o,likeParams:l}=s||{};if(i)return C({html:`${G("loginYtb")}`}),!1;if(!(n&&a&&r&&o&&l))return C({text:'"getYtbToken" failed'}),!1;if(!t&&this.whiteList.likes.includes(o))return C({type:"whiteList",text:"Youtube.unlikeVideo",id:o}),!0;const c=C({type:t?"likingYtbVideo":"unlikingYtbVideo",text:o});var u=parseInt(String((new Date).getTime()/1e3),10);const h={context:{client:a,request:{sessionId:r.sessionId,internalExperimentFlags:[],consistencyTokenJars:[]},user:{}},target:{videoId:o}};if(t){if(!l)return c.error("Empty likeParams"),!1;h.params=l}const{result:d,statusText:f,status:w,data:p}=await S({url:`https://www.youtube.com/youtubei/v1/like/${t?"":"remove"}like?key=${n}`,method:"POST",headers:{origin:"https://www.youtube.com",referer:`https://www.youtube.com/watch?v=${o}`,"content-type":"application/json","x-goog-authuser":"0","x-goog-visitor-id":a.visitorData,"x-origin":"https://www.youtube.com",authorization:`SAPISIDHASH ${u}_${sha1(`${u} ${Qe(this,is).PAPISID} https://www.youtube.com`)}`},data:JSON.stringify(h)});return"Success"===d?200===(null===p||void 0===p?void 0:p.status)?t&&p.responseText.includes("Added to Liked videos")||!t&&(p.responseText.includes("Removed from Liked videos")||p.responseText.includes("Dislike removed"))?(c.success(),t&&(this.tasks.likes=I([...this.tasks.likes,e])),!0):(c.error(G("tryUpdateYtbAuth"),!0),!1):(c.error(`Error:${null===p||void 0===p?void 0:p.statusText}(${null===p||void 0===p?void 0:p.status})`),!1):(c.error(`${d}:${f}(${w})`),!1)}catch(t){return A(t,"Youtube.toggleLikeVideo"),!1}}function vs(t,e){ks(t,e),e.add(t)}function gs(t,e,s){ks(t,e),e.set(t,s)}function ks(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ys(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function Ts(t,e,s){return function(t,e,s){if(e.set)e.set.call(t,s);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=s}}(t,xs(t,e,"set"),s),s}function $s(t,e,s){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return s}function bs(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,xs(t,e,"get"))}function xs(t,e,s){if(!e.has(t))throw new TypeError("attempted to "+s+" private field on non-instance");return e.get(t)}const Ls={groups:[],wishlists:[],follows:[],forums:[],workshops:[],workshopVotes:[],curators:[],curatorLikes:[],announcements:[]};var Ss=new WeakMap,Is=new WeakMap,_s=new WeakMap,As=new WeakMap,Gs=new WeakSet,Es=new WeakSet,Cs=new WeakSet,Ps=new WeakSet,Ws=new WeakSet,js=new WeakSet,Vs=new WeakSet,Ms=new WeakSet,Os=new WeakSet,Fs=new WeakSet,Ds=new WeakSet,Us=new WeakSet,Rs=new WeakSet,qs=new WeakSet,zs=new WeakSet,Ns=new WeakSet,Ks=new WeakSet,Ys=new WeakSet,Bs=new WeakSet,Hs=new WeakSet,Js=new WeakSet;(class extends t{});async function Zs(){try{const s=C({text:G("updatingAuth",G("steamStore"))}),{result:i,statusText:n,status:a,data:r}=await S({url:"https://store.steampowered.com/stats/",method:"GET"});if("Success"!==i)return s.error(`${i}:${n}(${a})`),!1;if(200!==(null===r||void 0===r?void 0:r.status))return s.error(`Error:${null===r||void 0===r?void 0:r.statusText}(${null===r||void 0===r?void 0:r.status})`),!1;var t;if(r.responseText.includes('href="https://store.steampowered.com/login/'))return s.error(`Error:${G("needLoginSteamStore")}`,!0),!1;var e=null===(t=r.responseText.match(/g_sessionID = "(.+?)";/))||void 0===t?void 0:t[1];return e?(bs(this,Is).storeSessionID=e,s.success(),!0):(s.error('Error: Get "sessionID" failed'),!1)}catch(t){return A(t,"Steam.updateStoreAuth"),!1}}async function Qs(){try{const r=C({text:G("updatingAuth",G("steamCommunity"))}),{result:o,statusText:l,status:u,data:c}=await S({url:"https://steamcommunity.com/my",method:"GET"});if("Success"!==o)return r.error(`${o}:${l}(${u})`),!1;if(200!==(null===c||void 0===c?void 0:c.status))return r.error(`Error:${null===c||void 0===c?void 0:c.statusText}(${null===c||void 0===c?void 0:c.status})`),!1;var t,e,s;if(c.responseText.includes('href="https://steamcommunity.com/login/home/'))return r.error(`Error:${G("needLoginSteamCommunity")}`,!0),!1;var i=null===(t=c.responseText.match(/g_steamID = "(.+?)";/))||void 0===t?void 0:t[1],n=null===(e=c.responseText.match(/g_sessionID = "(.+?)";/))||void 0===e?void 0:e[1],a=null===(s=c.responseText.match(/steamcommunity.com\/id\/(.+?)\/friends\//))||void 0===s?void 0:s[1];return(i&&(bs(this,Is).steam64Id=i),a&&(bs(this,Is).userName=a),n)?(bs(this,Is).communitySessionID=n,r.success(),!0):(r.error('Error: Get "sessionID" failed'),!1)}catch(t){return A(t,"Steam.updateCommunityAuth"),!1}}async function Xs(){try{const i=C({text:G("gettingAreaInfo")}),{result:n,statusText:a,status:r,data:o}=await S({url:"https://store.steampowered.com/cart/",method:"GET"});if("Success"!==n)return i.error(`${n}:${a}(${r})`),{};if(200!==(null===o||void 0===o?void 0:o.status))return i.error(`Error:${null===o||void 0===o?void 0:o.statusText}(${null===o||void 0===o?void 0:o.status})`),{};var t,e=null===(t=o.responseText.match(/<input id="usercountrycurrency".*?value="(.+?)"/))||void 0===t?void 0:t[1],s=[...o.responseText.matchAll(/<div class="currency_change_option .*?" data-country="(.+?)" >/g)].map(t=>t[1]);return e&&0<s.length?(Ts(this,As,e),i.success(),{currentArea:e,areas:s}):(i.error("Error: get country info filed"),{})}catch(t){return A(t,"Steam.getAreaInfo"),{}}}async function ti(e){try{let t=e;if(!t){const{currentArea:u,areas:c}=await $s(this,Cs,Xs).call(this);if(!u||!c)return!1;if("CN"!==u)return C({text:"notNeededChangeArea"}),"skip";var s=c.filter(t=>t&&"CN"!==t);if(!s||0===s.length)return C({text:"noAnotherArea"}),!1;[t]=s}const l=C({text:G("changingArea",t)});var{result:i,statusText:n,status:a,data:r}=await S({url:"https://store.steampowered.com/account/setcountry",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param({cc:t,sessionid:bs(this,Is).storeSessionID})});if("Success"!==i)return l.error(`${i}:${n}(${a})`),"CN";if(200!==(null==r?void 0:r.status)||"true"!==r.responseText)return l.error(`Error:${null==r?void 0:r.statusText}(${null==r?void 0:r.status})`),"CN";var o=(await $s(this,Cs,Xs).call(this))["currentArea"];return o===t?(l.success(),o):(l.error("Error: change country filed"),"CN")}catch(t){return A(t,"Steam.changeArea"),!1}}async function ei(t){try{const e=C({type:"joiningSteamGroup",text:t}),{result:s,statusText:i,status:n,data:a}=await S({url:`https://steamcommunity.com/groups/${t}`,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param({action:"join",sessionID:bs(this,Is).communitySessionID})});return"Success"===s?200!==(null===a||void 0===a?void 0:a.status)||a.responseText.includes("grouppage_join_area")?(e.error(`Error:${null===a||void 0===a?void 0:a.statusText}(${null===a||void 0===a?void 0:a.status})`),!1):(e.success(),this.tasks.groups=I([...this.tasks.groups,t]),!0):(e.error(`${s}:${i}(${n})`),!1)}catch(t){return A(t,"Steam.joinGroup"),!1}}async function si(t){try{if(this.whiteList.groups.includes(t))return C({type:"whiteList",text:"Steam.leaveGroup",id:t}),!0;var e=await $s(this,Vs,ii).call(this,t);if(!e)return!1;const s=C({type:"leavingSteamGroup",text:t}),{result:i,statusText:n,status:a,data:r}=await S({url:`https://steamcommunity.com/id/${bs(this,Is).userName}/home_process`,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param({sessionID:bs(this,Is).communitySessionID,action:"leaveGroup",groupId:e})});return"Success"===i?200===(null===r||void 0===r?void 0:r.status)&&r.finalUrl.includes("groups")&&0===$(r.responseText.replace(/<img.*?>/g,"").toLowerCase()).find(`a[href='https://steamcommunity.com/groups/${t.toLowerCase()}']`).length?(s.success(),!0):(s.error(`Error:${null===r||void 0===r?void 0:r.statusText}(${null===r||void 0===r?void 0:r.status})`),!1):(s.error(`${i}:${n}(${a})`),!1)}catch(t){return A(t,"Steam.leaveGroup"),!1}}async function ii(t){try{const n=C({type:"gettingSteamGroupId",text:t});var e=bs(this,Ss).group[t];if(e)return n.success(),e;const{result:a,statusText:r,status:o,data:l}=await S({url:`https://steamcommunity.com/groups/${t}`,method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}});if("Success"!==a)return n.error(`${a}:${r}(${o})`),!1;if(200!==(null===l||void 0===l?void 0:l.status))return n.error(`Error:${null===l||void 0===l?void 0:l.statusText}(${null===l||void 0===l?void 0:l.status})`),!1;var s,i=null===(s=l.responseText.match(/OpenGroupChat\( '([0-9]+)'/))||void 0===s?void 0:s[1];return i?($s(this,Js,vi).call(this,"group",t,i),n.success(),i):(n.error(`Error:${l.statusText}(${l.status})`),!1)}catch(t){return A(t,"Steam.getGroupID"),!1}}async function ni(t){try{var e;const n=C({type:"addingToWishlist",text:t});var{result:s,data:i}=await S({url:"https://store.steampowered.com/api/addtowishlist",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param({sessionid:bs(this,Is).storeSessionID,appid:t}),dataType:"json"});if("Success"===s&&200===(null==i?void 0:i.status)&&!0===(null===(e=i.response)||void 0===e?void 0:e.success))return n.success(),this.tasks.wishlists=I([...this.tasks.wishlists,t]),!0;const{result:a,statusText:r,status:o,data:l}=await S({url:`https://store.steampowered.com/app/${t}`,method:"GET"});return"Success"===a?200===(null===l||void 0===l?void 0:l.status)?"CN"===bs(this,As)&&l.responseText.includes('id="error_box"')?(n.warning("疑似锁区游戏，尝试换区执行"),!!await $s(this,Ps,ti).call(this)&&$s(this,Ms,ni).call(this,t)):(!l.responseText.includes('class="queue_actions_ctn"')||!l.responseText.includes('class="already_in_library"'))&&(l.responseText.includes('class="queue_actions_ctn"')&&l.responseText.includes('id="add_to_wishlist_area_success" style="display: none;')||!l.responseText.includes('class="queue_actions_ctn"'))?(n.error(`Error:${l.statusText}(${l.status})`),!1):(n.success(),this.tasks.wishlists=I([...this.tasks.wishlists,t]),!0):(n.error(`Error:${null===l||void 0===l?void 0:l.statusText}(${null===l||void 0===l?void 0:l.status})`),!1):(n.error(`${a}:${r}(${o})`),!1)}catch(t){return A(t,"Steam.addToWishlist"),!1}}async function ai(t){try{var e;if(this.whiteList.wishlists.includes(t))return C({type:"whiteList",text:"Steam.removeFromWishlist",id:t}),!0;const a=C({type:"removingFromWishlist",text:t});var{result:s,data:i}=await S({url:"https://store.steampowered.com/api/removefromwishlist",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param({sessionid:bs(this,Is).storeSessionID,appid:t}),dataType:"json"});if("Success"===s&&200===(null==i?void 0:i.status)&&!0===(null===(e=i.response)||void 0===e?void 0:e.success))return a.success(),!0;const{result:r,statusText:o,status:l,data:u}=await S({url:`https://store.steampowered.com/app/${t}`,method:"GET"});if("Success"!==r)return a.error(`${r}:${o}(${l})`),!1;if(200!==(null===u||void 0===u?void 0:u.status))return a.error(`Error:${null===u||void 0===u?void 0:u.statusText}(${null===u||void 0===u?void 0:u.status})`),!1;if("CN"===bs(this,As)&&u.responseText.includes('id="error_box"')){a.warning("疑似锁区游戏，尝试换区执行");var n=await $s(this,Ps,ti).call(this);return n&&"CN"!==n&&"skip"!==n?$s(this,Os,ai).call(this,t):!1}return u.responseText.includes('class="queue_actions_ctn"')&&(u.responseText.includes("已在库中")||u.responseText.includes("添加至您的愿望单"))?(a.success(),!0):(a.error(`Error:${u.statusText}(${u.status})`),!1)}catch(t){return A(t,"Steam.removeFromWishlist"),!1}}async function ri(t,e){try{if(!e&&this.whiteList.follows.includes(t))return C({type:"whiteList",text:"Steam.unfollowGame",id:t}),!0;const a=C({type:`${e?"":"un"}followingGame`,text:t}),r={sessionid:bs(this,Is).storeSessionID,appid:t};e||(r.unfollow="1");var{result:s,data:i}=await S({url:"https://store.steampowered.com/explore/followgame/",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(r)});if("Success"===s&&200===(null==i?void 0:i.status)&&"true"===i.responseText)return a.success(),!0;var n=await $s(this,Ds,oi).call(this,t);return"CN"===bs(this,As)&&"areaLocked"===n?(a.warning("疑似锁区游戏，尝试换区执行"),!!await $s(this,Ps,ti).call(this)&&$s(this,Os,ai).call(this,t)):e===n?(a.success(),e&&(this.tasks.follows=I([...this.tasks.follows,t])),!0):(a.error(`Error:${null==i?void 0:i.statusText}(${null==i?void 0:i.status})`),!1)}catch(t){return A(t,"Steam.toggleFollowGame"),!1}}async function oi(t){try{const{result:e,data:s}=await S({url:`https://store.steampowered.com/app/${t}`,method:"GET"});return"Success"===e?200===(null===s||void 0===s?void 0:s.status)&&("CN"===bs(this,As)&&s.responseText.includes('id="error_box"')?"areaLocked":"none"!==$(s.responseText.replace(/<img.*?>/g,"")).find(".queue_control_button.queue_btn_follow>.btnv6_blue_hoverfade.btn_medium.queue_btn_active").css("display")):!1}catch(t){return A(t,"Steam.isFollowedGame"),!1}}async function li(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];try{if(!e&&this.whiteList.forums.includes(t))return C({type:"whiteList",text:"Steam.unsubscribForum",id:t}),!0;const c=await $s(this,Rs,ui).call(this,t);if(!c)return!1;const h=C({type:`${e?"":"un"}subscribingForum`,text:t});var s,i,[n,a]=c.split("_"),{result:r,statusText:o,status:l,data:u}=await S({url:`https://steamcommunity.com/forum/${n}/General/${e?"":"un"}subscribe/${a||"0"}/`,method:"POST",responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param({sessionid:bs(this,Is).communitySessionID})});return"Success"===r?(200!==(null==u?void 0:u.status)||1!==(null===(s=u.response)||void 0===s?void 0:s.success)&&29!==(null===(i=u.response)||void 0===i?void 0:i.success)?h.error(`Error:${null==u?void 0:u.statusText}(${null==u?void 0:u.status})`):(e&&(this.tasks.forums=I([...this.tasks.forums,t])),h.success()),!0):(h.error(`${r}:${o}(${l})`),!0)}catch(t){return A(t,"Steam.toggleForum"),!0}}async function ui(t){try{const u=C({type:"gettingForumId",text:t});var e=bs(this,Ss).forum[t];if(e)return u.success(),e;var{result:s,statusText:i,status:n,data:a}=await S({url:`https://steamcommunity.com/app/${t}/discussions/`,method:"GET"});if("Success"!==s)return u.error(`${s}:${i}(${n})`),!1;if(200!==(null==a?void 0:a.status))return u.error(`Error:${null==a?void 0:a.statusText}(${null==a?void 0:a.status})`),!1;var r,o,l=null===(r=a.responseText)||void 0===r||null===(o=r.match(/General_([\d]+(_[\d]+)?)/))||void 0===o?void 0:o[1];return l?($s(this,Js,vi).call(this,"forum",t,l),u.success(),l):(u.error(`Error:${a.statusText}(${a.status})`),!1)}catch(t){return A(t,"Steam.getForumId"),!1}}async function ci(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];try{if(!e&&this.whiteList.workshops.includes(t))return C({type:"whiteList",text:"Steam.unfavoriteWorkshop",id:t}),!0;var s=await $s(this,zs,hi).call(this,t);if(!s)return!1;const o=C({type:e?"favoritingWorkshop":"unfavoritingWorkshop",text:t});var{result:i,statusText:n,status:a,data:r}=await S({url:`https://steamcommunity.com/sharedfiles/${e?"":"un"}favorite`,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param({id:t,appid:s,sessionid:bs(this,Is).communitySessionID})});return"Success"===i?200!==(null==r?void 0:r.status)||r.responseText?(o.error(`Error:${null==r?void 0:r.statusText}(${null==r?void 0:r.status})`),!1):(e&&(this.tasks.workshops=I([...this.tasks.workshops,t])),o.success(),!0):(o.error(`${i}:${n}(${a})`),!1)}catch(t){return A(t,"Steam.toggleFavoriteWorkshop"),!1}}async function hi(t){try{const n=C({type:"gettingWorkshopAppId",text:t});var e=bs(this,Ss).workshop[t];if(e)return n.success(),e;const{result:a,statusText:r,status:o,data:l}=await S({url:`https://steamcommunity.com/sharedfiles/filedetails/?id=${t}`,method:"GET"});if("Success"!==a)return n.error(`${a}:${r}(${o})`),!1;if(200!==(null===l||void 0===l?void 0:l.status))return n.error(`Error:${null===l||void 0===l?void 0:l.statusText}(${null===l||void 0===l?void 0:l.status})`),!1;var s,i=null===(s=l.responseText.match(/<input type="hidden" name="appid" value="([\d]+?)" \/>/))||void 0===s?void 0:s[1];return i?($s(this,Js,vi).call(this,"workshop",t,i),n.success(),i):(n.error("Error: getWorkshopAppId failed"),!1)}catch(t){return A(t,"Steam.getWorkshopAppId"),!1}}async function di(t){try{const r=C({type:"votingUpWorkshop",text:t});var e,{result:s,statusText:i,status:n,data:a}=await S({url:"https://steamcommunity.com/sharedfiles/voteup",method:"POST",responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param({id:t,sessionid:bs(this,Is).communitySessionID})});return"Success"===s?(200===(null==a?void 0:a.status)&&1===(null===(e=a.response)||void 0===e?void 0:e.success)?r.success():r.error(`Error:${null==a?void 0:a.statusText}(${null==a?void 0:a.status})`),!0):(r.error(`${s}:${i}(${n})`),!0)}catch(t){return A(t,"Steam.voteupWorkshop"),!0}}async function fi(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];try{if(!e&&this.whiteList.curators.includes(t))return C({type:"whiteList",text:"Steam.unfollowCurator",id:t}),!0;const u=C({type:e?"followingCurator":"unfollowingCurator",text:t});var s,i,n,{result:a,statusText:r,status:o,data:l}=await S({url:"https://store.steampowered.com/curators/ajaxfollow",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param({clanid:t,sessionid:bs(this,Is).storeSessionID,follow:e}),dataType:"json"});return"Success"===a?200===(null==l?void 0:l.status)&&1===(null===(s=l.response)||void 0===s||null===(i=s.success)||void 0===i?void 0:i.success)?(u.success(),!0):(u.error(`Error:${null==l?void 0:l.statusText}(${null==l||null===(n=l.response)||void 0===n?void 0:n.success}`||`${null==l?void 0:l.status})`),!1):(u.error(`${a}:${r}(${o})`),!1)}catch(t){return A(t,"Steam.toggleCurator"),!1}}async function wi(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];try{var[s,i]=t.split("/");if(!s||!i)return C({text:G("errorLink",t)}),!1;var n=await this.getCuratorId(s,i);return n?$s(this,Ks,fi).call(this,n,e):!1}catch(t){return A(t,"Steam.toggleCuratorLike"),!1}}async function pi(t,e){try{const l=C({type:"gettingAnnouncementParams",text:t,id:e}),{result:u,statusText:c,status:h,data:d}=await S({url:`https://store.steampowered.com/news/app/${t}/view/${e}`,method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}});if("Success"!==u)return l.error(`${u}:${c}(${h})`),{};if(200!==(null===d||void 0===d?void 0:d.status))return l.error(`Error:${null===d||void 0===d?void 0:d.statusText}(${null===d||void 0===d?void 0:d.status})`),{};var s,i,n,a=null===(s=d.responseText.match(/authwgtoken&quot;:&quot;(.*?)&quot;/))||void 0===s?void 0:s[1],r=null===(i=d.responseText.match(/clanAccountID&quot;:([\d]+?),/))||void 0===i?void 0:i[1],o=null===(n=d.responseText.match(/announcementGID&quot;:&quot;([\d]+?)&quot;/))||void 0===n?void 0:n[1];return a&&r?(l.success(),{authWgToken:a,clanId:r,gid:o}):(l.error(`Error:${d.statusText}(${d.status})`),{})}catch(t){return A(t,"Steam.likeAnnouncement"),{}}}async function mi(t){try{var[e,s]=t.split("/");if(!e||!s)return C({type:"lost params",text:t}),!1;var{authWgToken:i,clanId:n,gid:a}=await $s(this,Bs,pi).call(this,e,s);if(!i||!n)return!1;const c=C({type:"likingAnnouncement",text:e,id:s});var{result:r,statusText:o,status:l,data:u}=await S({url:`https://store.steampowered.com/updated/ajaxrateupdate/${a||s}`,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Host:"store.steampowered.com",Origin:"https://store.steampowered.com",Referer:`https://store.steampowered.com/news/app/${e}/view/${s}`},data:$.param({sessionid:bs(this,Is).storeSessionID,wgauthtoken:i,voteup:1,clanid:n,ajax:1}),dataType:"json"});return"Success"===r?200===(null==u?void 0:u.status)&&1===u.response.success?(c.success(),!0):(c.error(`Error:${null==u?void 0:u.statusText}(${null==u?void 0:u.status})`),!1):(c.error(`${r}:${o}(${l})`),!1)}catch(t){return A(t,"Steam.likeAnnouncement"),!1}}function vi(t,e,s){try{bs(this,Ss)[t][e]=s,GM_setValue("steamCache",bs(this,Ss))}catch(t){A(t,"Steam.setCache")}}const gi=class extends t{constructor(){var t;super(...arguments),vs(this,Js),vs(this,Hs),vs(this,Bs),vs(this,Ys),vs(this,Ks),vs(this,Ns),vs(this,zs),vs(this,qs),vs(this,Rs),vs(this,Us),vs(this,Ds),vs(this,Fs),vs(this,Os),vs(this,Ms),vs(this,Vs),vs(this,js),vs(this,Ws),vs(this,Ps),vs(this,Cs),vs(this,Es),vs(this,Gs),ys(this,"tasks",{...Ls}),ys(this,"whiteList",(null===(t=GM_getValue("whiteList"))||void 0===t?void 0:t.steam)||{...Ls}),gs(this,Ss,{writable:!0,value:GM_getValue("steamCache")||{group:{},forum:{},workshop:{},curator:{}}}),gs(this,Is,{writable:!0,value:{}}),gs(this,_s,{writable:!0,value:!1}),gs(this,As,{writable:!0,value:"CN"})}async init(){try{return bs(this,_s)?!0:await $s(this,Gs,Zs).call(this)&&await $s(this,Es,Qs).call(this)?(Ts(this,_s,!0),C({html:`<li><font class="success">${G("initSuccess","Steam")}</font></li>`}),!0):(C({html:`<li><font class="success">${G("initFailed","Reddit")}</font></li>`}),!1)}catch(t){return A(t,"Steam.init"),!1}}async getCuratorId(t,e){try{const a=C({type:"gettingCuratorId",text:`${t}/${e}`});var s=bs(this,Ss).curator[`${t}/${e}`];if(s)return a.success(),s;const{result:r,statusText:o,status:l,data:u}=await S({url:`https://store.steampowered.com/${t}/${e}`,method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}});if("Success"!==r)return a.error(`${r}:${o}(${l})`),!1;if(200!==(null===u||void 0===u?void 0:u.status))return a.error(`Error:${null===u||void 0===u?void 0:u.statusText}(${null===u||void 0===u?void 0:u.status})`),!1;var i,n=null===(i=u.responseText.match(/g_pagingData.*?"clanid":([\d]+)/))||void 0===i?void 0:i[1];return n?($s(this,Js,vi).call(this,"curator",`${t}/${e}`,n),a.success(),n):(a.error(`Error:${u.statusText}(${u.status})`),!1)}catch(t){return A(t,"Steam.getCuratorID"),!1}}async toggle(t){var{doTask:e=!0,groupLinks:s=[],wishlistLinks:i=[],followLinks:n=[],forumLinks:a=[],workshopLinks:r=[],workshopVoteLinks:o=[],curatorLinks:l=[],curatorLikeLinks:u=[],announcementLinks:t=[]}=t;try{if(!bs(this,_s))return C({text:G("needInit")}),!1;const k=[];var c=this.getRealParams("groups",s,e,t=>{return null===(t=t.match(/groups\/(.+)\/?/))||void 0===t?void 0:t[1]}),h=this.getRealParams("wishlists",i,e,t=>{return null===(t=t.match(/app\/([\d]+)/))||void 0===t?void 0:t[1]}),d=this.getRealParams("follows",n,e,t=>{return null===(t=t.match(/app\/([\d]+)/))||void 0===t?void 0:t[1]}),f=this.getRealParams("forums",a,e,t=>{return null===(t=t.match(/app\/([\d]+)/))||void 0===t?void 0:t[1]}),w=this.getRealParams("workshops",r,e,t=>{return null===(t=t.match(/\?id=([\d]+)/))||void 0===t?void 0:t[1]}),p=this.getRealParams("workshopVotes",o,e,t=>{return null===(t=t.match(/\?id=([\d]+)/))||void 0===t?void 0:t[1]}),m=this.getRealParams("curators",l,e,t=>{return null===(t=t.match(/curator\/([\d]+)/))||void 0===t?void 0:t[1]}),v=this.getRealParams("curatorLikes",u,e,t=>{return null===(t=t.match(/https?:\/\/store\.steampowered\.com\/(.*?)\/([^/?]+)/))||void 0===t?void 0:t.slice(1,3).join("/")}),g=this.getRealParams("announcements",t,e,t=>{var e;return t.includes("store.steampowered.com")?null===(e=t.match(/store.steampowered.com\/news\/app\/([\d]+)\/view\/([\d]+)/))||void 0===e?void 0:e.slice(1,3).join("/"):null===(t=t.match(/steamcommunity.com\/games\/([\d]+)\/announcements\/detail\/([\d]+)/))||void 0===t?void 0:t.slice(1,3).join("/")});if(0<c.length)for(const y of c)e?k.push($s(this,Ws,ei).call(this,y)):k.push($s(this,js,si).call(this,y)),await E(1e3);if(0<h.length)for(const T of h)e?k.push($s(this,Ms,ni).call(this,T)):k.push($s(this,Os,ai).call(this,T)),await E(1e3);if(0<d.length)for(const $ of d)k.push($s(this,Fs,ri).call(this,$,e)),await E(1e3);if(0<f.length)for(const b of f)k.push($s(this,Us,li).call(this,b,e)),await E(1e3);if(0<w.length)for(const x of w)k.push($s(this,qs,ci).call(this,x,e)),await E(1e3);if(e&&0<p.length)for(const L of p)k.push($s(this,Ns,di).call(this,L)),await E(1e3);if(0<m.length)for(const S of m)k.push($s(this,Ks,fi).call(this,S,e)),await E(1e3);if(0<v.length)for(const I of v)k.push($s(this,Ys,wi).call(this,I,e)),await E(1e3);if(e&&0<g.length)for(const _ of g)k.push($s(this,Hs,mi).call(this,_)),await E(1e3);return Promise.all(k).then(()=>!0)}catch(t){return A(t,"Steam.toggle"),!1}}};function ki(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class yi{constructor(){ki(this,"undoneTasks",void 0),ki(this,"socialTasks",void 0),ki(this,"giveawayId",void 0),ki(this,"socialInitialized",!1),ki(this,"initialized",!1),ki(this,"social",{})}async initSocial(t){try{if(this.socialInitialized)return!0;const s=[];var e="do"===t?this.undoneTasks:this.socialTasks;return e.discord&&0<Object.values(e.discord).reduce((t,e)=>[...t,...e]).length&&(this.social.discord=new F,s.push(this.social.discord.init())),e.instagram&&0<Object.values(e.instagram).reduce((t,e)=>[...t,...e]).length&&(this.social.instagram=new rt,s.push(this.social.instagram.init())),e.reddit&&0<Object.values(e.reddit).reduce((t,e)=>[...t,...e]).length&&(this.social.reddit=new $t,s.push(this.social.reddit.init())),e.twitch&&0<Object.values(e.twitch).reduce((t,e)=>[...t,...e]).length&&(this.social.twitch=new Nt,s.push(this.social.twitch.init())),e.twitter&&0<Object.values(e.twitter).reduce((t,e)=>[...t,...e]).length&&(this.social.twitter=new ve,s.push(this.social.twitter.init())),e.vk&&0<Object.values(e.vk).reduce((t,e)=>[...t,...e]).length&&(this.social.vk=new Ke,s.push(this.social.vk.init())),e.youtube&&0<Object.values(e.youtube).reduce((t,e)=>[...t,...e]).length&&(this.social.youtube=new hs,s.push(this.social.youtube.init())),e.steam&&0<Object.values(e.steam).reduce((t,e)=>[...t,...e]).length&&(this.social.steam=new gi,s.push(this.social.steam.init())),e.links&&0<e.links.length&&(this.social.visitLink=r),this.socialInitialized=await Promise.all(s).then(t=>!t.includes(!1)),this.socialInitialized}catch(t){return A(t,"Website.initSocial"),!1}}uniqueTasks(t){const e={};for(var[s,i]of Object.entries(t)){e[s]={};for(var[n,a]of Object.entries(i))e[s][n]=I(a)}return e}async toggleTask(t){try{if(!this.initialized&&!this.init())return!1;if(!await this.classifyTask(t))return!1;if(!this.socialInitialized&&!await this.initSocial(t))return!1;const i=[];var e="do"===t,s=e?this.undoneTasks:this.socialTasks;if(this.social.discord&&i.push(this.social.discord.toggle({doTask:e,...s.discord})),this.social.instagram&&i.push(this.social.instagram.toggle({doTask:e,...s.instagram})),this.social.reddit&&i.push(this.social.reddit.toggle({doTask:e,...s.reddit})),this.social.twitch&&i.push(this.social.twitch.toggle({doTask:e,...s.twitch})),this.social.twitter&&i.push(this.social.twitter.toggle({doTask:e,...s.twitter})),this.social.vk&&i.push(this.social.vk.toggle({doTask:e,...s.vk})),this.social.youtube&&i.push(this.social.youtube.toggle({doTask:e,...s.youtube})),this.social.steam&&i.push(this.social.steam.toggle({doTask:e,...s.steam})),this.social.visitLink&&s.links&&e)for(const n of s.links)i.push(this.social.visitLink(n));return e&&s.extra&&this.extraDoTask&&0<Object.values(s.extra).reduce((t,e)=>[...t,...e]).length&&i.push(this.extraDoTask(s.extra)),await Promise.all(i),C({html:`<li><font class="success">${G("allTasksComplete")}</font></li>`}),!0}catch(t){return A(t,"Website.toggleTask"),!1}}async doTask(){try{return this.toggleTask("do")}catch(t){return A(t,"Website.doTask"),!1}}async undoTask(){try{return this.toggleTask("undo")}catch(t){return A(t,"Website.undoTask"),!1}}checkLogin(){return!0}checkLeftKey(){return!0}}t=yi;function Ti(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function $i(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function bi(t,e,s){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return s}const xi={steam:{groupLinks:[],wishlistLinks:[],curatorLinks:[],followLinks:[]},vk:{nameLinks:[]}};var Li=new WeakSet,Si=new WeakSet;class Ii extends t{constructor(){super(...arguments),Ti(this,Si),Ti(this,Li),$i(this,"name","FreeAnyWhere"),$i(this,"tasks",[]),$i(this,"socialTasks",{...xi}),$i(this,"undoneTasks",{...xi})}static test(){return"freeanywhere.net"===window.location.host}init(){try{const s=C({text:G("initing")});if(0<$('a[href="#/login"]').length)return window.open("/#/login","_self"),s.warning(G("needLogin")),!1;if(window.location.href.includes("/login"))return s.warning(G("needLogin")),!1;if(!/^https?:\/\/freeanywhere\.net\/#\/giveaway\/[\d]+/.test(window.location.href)){var t,e=null===(t=window.location.href.match(/https?:\/\/freeanywhere\.net\/.*?#\/giveaway\/([\d]+)/))||void 0===t?void 0:t[1];if(!e)return s.error(G("getFailed","Id")),!1;window.location.href=`https://freeanywhere.net/#/giveaway/${e}`}return bi(this,Li,_i).call(this)?(this.initialized=!0,s.success(),!0):!1}catch(t){return A(t,"Freeanywhere.init"),!1}}async classifyTask(t){try{const u=C({text:G("getTasksInfo")});this.socialTasks=GM_getValue(`fawTasks-${this.giveawayId}`)||{...xi};var{result:e,statusText:s,status:i,data:n}=await S({url:`https://freeanywhere.net/api/v1/giveaway/${this.giveawayId}/?format=json`,method:"GET",headers:{authorization:`Token ${window.localStorage.getItem("token")}`,"x-csrftoken":d.get("csrftoken")},responseType:"json"});if("Success"!==e)return u.error(`${e}:${s}(${i})`),!1;var a,r=null==n||null===(a=n.response)||void 0===a?void 0:a.challenges;if(r){"verify"===t&&(this.tasks=[]);for(const c of r){var o=c.challenge,l=c.challenge_provider;const h={id:c.id,title:c.title,done:c.is_success,link:c.link};if("verify"!==t||c.is_success)switch(l){case"steam":switch(h.social="steam",o){case"WL":"undo"===t&&this.socialTasks.steam.wishlistLinks.push(c.link),"do"!==t||c.is_success||this.undoneTasks.steam.wishlistLinks.push(c.link);break;case"JTG":"undo"===t&&this.socialTasks.steam.groupLinks.push(c.link),"do"!==t||c.is_success||this.undoneTasks.steam.groupLinks.push(c.link);break;case"STC":"undo"===t&&this.socialTasks.steam.curatorLinks.push(c.link),"do"!==t||c.is_success||this.undoneTasks.steam.curatorLinks.push(c.link);break;case"GF":"undo"===t&&this.socialTasks.steam.followLinks.push(c.link),"do"!==t||c.is_success||this.undoneTasks.steam.followLinks.push(c.link)}break;case"vk-oauth2":"undo"===t&&this.socialTasks.vk.nameLinks.push(c.link),"do"!==t||c.is_success||this.undoneTasks.vk.nameLinks.push(c.link)}else this.tasks.push(h)}return u.success(),this.undoneTasks=this.uniqueTasks(this.undoneTasks),this.socialTasks=this.uniqueTasks(this.socialTasks),GM_setValue(`fawTasks${this.giveawayId}`,this.socialTasks),!0}return u.error(`Error:${null==n?void 0:n.statusText}(${null==n?void 0:n.status})`),console.error(n),!1}catch(t){return A(t,"Freeanywhere.classifyTask"),!1}}async verifyTask(){try{if(!this.initialized&&!this.init())return!1;if(0===this.tasks.length&&!await this.classifyTask("verify"))return!1;const t=[];for(const e of this.tasks)t.push(bi(this,Si,Ai).call(this,e)),await E(1e3);return await Promise.all(t),C({html:`<li><font class="success">${G("allTasksComplete")}</font></li>`}),!!await this.getKey(!0)}catch(t){return A(t,"Freeanywhere.verifyTask"),!1}}async getKey(t){try{if(!t&&!this.initialized&&!this.init())return!1;const r=C({text:G("gettingKey")});var e,{result:s,statusText:i,status:n,data:a}=await S({url:`https://freeanywhere.net/api/v1/giveaway/${this.giveawayId}/reward/?format=json`,method:"GET",dataType:"json",headers:{authorization:`Token ${window.localStorage.getItem("token")}`}});return"Success"===s?null!=a&&null!==(e=a.response)&&void 0!==e&&e.reward?(r.success(),C({html:`<li><font class="success">${a.response.reward}</font></li>`}),a.response.reward):(r.error(`Error:${null==a?void 0:a.statusText}(${null==a?void 0:a.status})`),!1):(r.error(`${s}:${i}(${n})`),!1)}catch(t){return A(t,"FreeAnyWhere.getGiveawayId"),!1}}}function _i(){try{var t,e=null===(t=window.location.href.match(/\/giveaway\/([\d]+)/))||void 0===t?void 0:t[1];return e?(this.giveawayId=e,!0):(C({html:`<li><font class="error">${G("getFailed","GiveawayId")}</font></li>`}),!1)}catch(t){A(t,"FreeAnyWhere.getGiveawayId")}}async function Ai(t){try{const r=C({html:`<li>${G("verifyingTask")}${t.title.trim()}...<font></font></li>`});var e,{result:s,statusText:i,status:n,data:a}=await S({url:`https://freeanywhere.net/api/v1/giveaway/${this.giveawayId}/challenge-status/${t.id}/?format=json`,method:"GET",dataType:"json",headers:{authorization:`Token ${window.localStorage.getItem("token")}`,"x-csrftoken":d.get("csrftoken")}});return"Success"===s?null!=a&&null!==(e=a.response)&&void 0!==e&&e.status?(r.success(),!0):(r.error(`Error:${null==a?void 0:a.statusText}(${null==a?void 0:a.status})`),!1):(r.error(`${s}:${i}(${n})`),!1)}catch(t){return A(t,"Freeanywhere.verify"),!1}}function Gi(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function Ei(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const Ci={steam:{groupLinks:[],wishlistLinks:[],curatorLinks:[],curatorLikeLinks:[],followLinks:[],forumLinks:[],announcementLinks:[],workshopVoteLinks:[]},discord:{serverLinks:[]},instagram:{userLinks:[]},vk:{nameLinks:[]},twitch:{channelLinks:[]},reddit:{redditLinks:[]},youtube:{channelLinks:[],likeLinks:[]}};var Pi=new WeakSet;class Wi extends t{constructor(){super(...arguments),Gi(this,Pi),Ei(this,"name","GiveawaySu"),Ei(this,"socialTasks",Ci),Ei(this,"undoneTasks",Ci)}static test(){return/^https?:\/\/giveaway\.su\/giveaway\/view\/[\d]+/.test(window.location.href)}async before(){try{this.checkLogin()||C({html:`<li><font class="warning>${G("checkLoginFailed")}</font></li>`}),await this.checkLeftKey()||C({html:`<li><font class="warning>${G("checkLeftKeyFailed")}</font></li>`})}catch(t){A(t,"Giveawaysu.before")}}init(){try{const t=C({text:G("initing")});return 0<$("a.steam-login").length?(window.open("/steam/redirect","_self"),t.warning(G("needLogin")),!1):!!function(t,e,s){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return s}(this,Pi,ji).call(this)&&(this.initialized=!0,t.success(),!0)}catch(t){return A(t,"Giveawaysu.init"),!1}}async classifyTask(){try{const e=C({text:G("getTasksInfo")});this.socialTasks=GM_getValue(`gasTasks-${this.giveawayId}`)||Ci;const s=[];var t=$("#actions tr");$("div.bind-discord").is(":visible")&&$("div.bind-discord a")[0].click(),$("div.bind-twitch").is(":visible")&&$("div.bind-twitch a")[0].click();for(const o of t)s.push(new Promise(e=>{const t=$(o).find('td:not(".hidden")');var s=t.eq(1).find('a:not([data-trigger="link"])'),i=t.eq(2).find('a:not([data-trigger="link"])');const n=0<s.length?s:i,a=t.eq(0).find("i").attr("class")||"",r=n.text().trim();if(a.includes("ban")||/disable adblock/gi.test(r))return e(!0);u(n.attr("href")).then(t=>t?(a.includes("steam")&&/join/gi.test(r)?this.undoneTasks.steam.groupLinks.push(t):/like.*announcement/gi.test(r)?this.undoneTasks.steam.announcementLinks.push(t):/(follow|subscribe).*curator/gim.test(r)&&/^https?:\/\/store\.steampowered\.com\/curator\//.test(t)?this.undoneTasks.steam.curatorLinks.push(t):a.includes("steam")&&/follow|subscribe/gim.test(r)?this.undoneTasks.steam.curatorLikeLinks.push(t):/subscribe.*steam.*forum/gim.test(r)?this.undoneTasks.steam.forumLinks.push(t):a.includes("thumbs-up")&&/^https?:\/\/steamcommunity\.com\/sharedfiles\/filedetails\/\?id=[\d]+/.test(t)?this.undoneTasks.steam.workshopVoteLinks.push(t):a.includes("discord")||/join.*discord/gim.test(r)?this.undoneTasks.discord.serverLinks.push(t):a.includes("instagram")||/follow.*instagram/gim.test(r)?this.undoneTasks.instagram.userLinks.push(t):a.includes("twitch")||/follow.*twitch.*channel/gim.test(r)?this.undoneTasks.twitch.channelLinks.push(t):a.includes("reddit")||/subscribe.*subreddit/gim.test(r)||/follow.*reddit/gim.test(r)?this.undoneTasks.reddit.redditLinks.push(t):/watch.*art/gim.test(r)?this.undoneTasks.steam.workshopVoteLinks.push(t):/subscribe.*youtube.*channel/gim.test(r)?this.undoneTasks.youtube.channelLinks.push(t):/(watch|like).*youtube.*video/gim.test(r)||(a.includes("youtube")||a.includes("thumbs-up"))&&/(watch|like).*video/gim.test(r)?this.undoneTasks.youtube.likeLinks.push(t):a.includes("vk")||/join.*vk.*group/gim.test(r)?this.undoneTasks.vk.nameLinks.push(t):/(on twitter)|(Follow.*on.*Facebook)/gim.test(r)||(/wishlist.*game|add.*wishlist/gim.test(r)&&this.undoneTasks.steam.wishlistLinks.push(t),/follow.*button/gim.test(r)&&this.undoneTasks.steam.followLinks.push(t)),void e(!0)):e(!1)).catch(t=>(A(t,"Giveawaysu.classifyTask->getRedirectLink"),!1))}));return await Promise.all(s),e.success(),this.undoneTasks=this.uniqueTasks(this.undoneTasks),this.socialTasks=this.undoneTasks,GM_setValue(`gasTasks${this.giveawayId}`,this.socialTasks),!0}catch(t){return A(t,"Giveawaysu.classifyTask"),!1}}checkLogin(){try{return 0<$("a.steam-login").length&&window.open("/steam/redirect","_self"),!0}catch(t){return A(t,"Giveawaysu.checkLogin"),!1}}async checkLeftKey(){try{return 0<$(".giveaway-ended").length&&await o().fire({icon:"warning",title:G("notice"),text:G("noKeysLeft"),confirmButtonText:G("confirm"),cancelButtonText:G("cancel"),showCancelButton:!0}).then(t=>{var t=t["value"];t&&window.close()}),!0}catch(t){return A(t,"Giveawaysu.checkLeftKey"),!1}}}function ji(){var t=null===(t=window.location.href.match(/\/view\/([\d]+)/))||void 0===t?void 0:t[1];return t?(this.giveawayId=t,!0):(C({text:G("getFailed","GiveawayId")}),!1)}function Vi(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function Mi(t,e,s){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return s}var Oi=new WeakSet,Fi=new WeakSet;async function Di(){try{if(0<$("a.buttonenter:contains(Register to join)").length)return C({html:`<li><font class="error">${G("needLogin")}</font></li>`}),!1;const u=$("a.buttonenter.buttongiveaway");if(/join giveaway/gim.test(u.text())){const c=C({text:G("joiningGiveaway")});var t,e,s,i,n,{result:a,statusText:r,status:o,data:l}=await S({url:u.attr("href"),method:"POST",data:"ajax=t",dataType:"json",headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8",accept:"application/json, text/javascript, */*; q=0.01",origin:window.location.origin}});return"Success"===a?200===(null==l?void 0:l.status)?null!==(t=l.response)&&void 0!==t&&t.success?(u.addClass("buttonentered").text("Success - Giveaway joined"),$("#giveawaysjoined").slideDown(),$("#giveawaysrecommend").slideDown(),c.success(`Success${null!==(i=l.response)&&void 0!==i&&i.text?`:${null===(n=l.response)||void 0===n?void 0:n.text}`:""}`),!0):(c.error(`Error${null!==(e=l.response)&&void 0!==e&&e.text?`:${null===(s=l.response)||void 0===s?void 0:s.text}`:""}`),!1):(c.error(`Error:${null==l?void 0:l.statusText}(${null==l?void 0:l.status})`),!1):(c.error(`${a}:${r}(${o})`),!1)}return/success/gim.test($("a.buttonenter.buttongiveaway").text())?!0:(C({html:`<li><font class="warning">${G("needJoinGiveaway")}</font></li>`}),!1)}catch(t){return A(t,"Indiedb.init"),!1}}async function Ui(){try{const e=$("script").map((t,e)=>{var s,i,n,a,r;return/\$\(document\)/gim.test(e.innerHTML)?[null===(s=e.innerHTML.match(/"\/[\d]+"/gim))||void 0===s||null===(i=s[0])||void 0===i||null===(n=i.match(/[\d]+/))||void 0===n?void 0:n[0],null===(e=e.innerHTML.match(/"\/newsletter\/ajax\/subscribeprofile\/optin\/[\d]+"/gim))||void 0===e||null===(a=e[0])||void 0===a||null===(r=a.match(/[\d]+/))||void 0===r?void 0:r[0]]:null});if(2!==e.length)return C({html:`<li><font class="error">${G("getFailed","TaskId")}</font></li>`}),!1;{const s=[];for(const t of $("#giveawaysjoined a[class*=promo]")){const n=$(t);if(!n.hasClass("buttonentered")){const a=C({text:`${G("doing")}:${n.parents("p").text()}...`});if(/facebookpromo|twitterpromo|visitpromo/gim.test(t.className)){let t="";t=n.hasClass("facebookpromo")?"facebookpromo":n.hasClass("twitterpromo")?"twitterpromo":"visitpromo",s.push(new Promise(i=>{$.ajax({type:"POST",url:urlPath(`/giveaways/ajax/${t}/${e[0]}`),timeout:6e4,dataType:"json",data:{ajax:"t"},error(t,e,s){console.log({response:t,error:e,exception:s}),a.error("Error:An error has occurred performing the action requested. Please try again shortly."),i(!0)},success(t){console.log(t),t.success?(a.success(`Success:${t.text}`),n.addClass("buttonentered").closest("p").html(n.closest("p").find("span").html())):a.error(`Error:${t.text}`),i(!0)}})}))}else n.hasClass("emailoptinpromo")?s.push(new Promise(i=>{$.ajax({type:"POST",url:urlPath(`/newsletter/ajax/subscribeprofile/optin/${e[1]}`),timeout:6e4,dataType:"json",data:{ajax:"t",emailsystoggle:4},error(t,e,s){console.log({response:t,error:e,exception:s}),a.error("Error:An error has occurred performing the action requested. Please try again shortly."),i(!0)},success(t){console.log(t),t.success?(a.success(`Success:${t.text}`),n.toggleClass("buttonentered").closest("p").html(n.closest("p").find("span").html())):a.error(`Error:${t.text}`),i(!0)}})})):n.hasClass("watchingpromo")?s.push(new Promise(i=>{var t;const e=(t=>{try{const i={};return t?t.includes("?")&&t.split("?")[1].replace(/([^?&=]+)=([^&]+)/g,(t,e,s)=>(i[e]=s,t)):window.location.search.replace(/([^?&=]+)=([^&]+)/g,(t,e,s)=>(i[e]=s,t)),i}catch(t){return A(t,"getUrlQuery"),{}}})(n.attr("href"));e.ajax="t",$.ajax({type:"POST",url:urlPath(null===(t=n.attr("href"))||void 0===t?void 0:t.split(/[?#]/)[0]),timeout:6e4,dataType:"json",data:e,error(t,e,s){console.log({response:t,error:e,exception:s}),a.error("Error:An error has occurred performing the action requested. Please try again shortly."),i(!0)},success(t){console.log(t),t.success?(a.success(`Success:${t.text}`),n.toggleClass("buttonentered").closest("p").html(n.closest("p").find("span").html())):a.error(`Error:${t.text}`),i(!0)}})})):/the-challenge-of-adblock/gim.test(n.attr("href"))?a.error(`Error:${G("unKnownTaskType")}`):s.push(new Promise(i=>{$.ajax({type:"POST",url:urlPath(n.attr("href")),timeout:6e4,dataType:"json",data:{ajax:"t"},error(t,e,s){console.log({response:t,error:e,exception:s}),a.error("Error:An error has occurred performing the action requested. Please try again shortly."),i(!0)},success(t){console.log(t),t.success?(a.success(`Success:${t.text}`),n.toggleClass("buttonentered").closest("p").html(n.closest("p").find("span").html())):a.error(`Error:${t.text}`),i(!0)}})}))}}return await Promise.all(s),C({html:`<li><font class="success">${G("allTasksComplete")}</font></li>`}),!0}}catch(t){return A(t,"Indiedb.classifyTask"),!1}}function Ri(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function qi(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const zi={steam:{groupLinks:[],wishlistLinks:[],curatorLinks:[]},discord:{serverLinks:[]},links:[]};var Ni=new WeakSet;class Ki extends t{constructor(){super(...arguments),Ri(this,Ni),qi(this,"name","Keyhub"),qi(this,"socialTasks",{...zi}),qi(this,"undoneTasks",{...zi})}static test(){return"key-hub.eu"===window.location.host}async before(){try{this.checkLogin()||C({html:`<li><font class="warning>${G("checkLoginFailed")}</font></li>`}),await this.checkLeftKey()||C({html:`<li><font class="warning>${G("checkLeftKeyFailed")}</font></li>`})}catch(t){A(t,"Keyhub.before")}}init(){try{const t=C({text:G("initing")});return 0<$('a[href*="/connect/steam"]').length?(window.open("/connect/steam","_self"),t.warning(G("needLogin")),!1):!!function(t,e,s){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return s}(this,Ni,Yi).call(this)&&($("#VPNoverlay").hide(),$("#mainArticleSection").show(),this.initialized=!0,t.success(),!0)}catch(t){return A(t,"Keyhub.init"),!1}}async classifyTask(e){try{const t=C({text:G("getTasksInfo")});this.socialTasks=GM_getValue(`khTasks-${this.giveawayId}`)||{...zi};for(const i of $(".task a")){let t=$(i).attr("href");var s=$(i).text().trim();t&&((/\/away\?data=/.test(t)||/steamcommunity\.com\/gid\//.test(t))&&(t=await u(t)||t),/https?:\/\/key-hub\.eu\/connect\/discord/.test(t)?window.open(t,"_blank"):/steamcommunity\.com\/groups\//.test(t)?("undo"===e&&this.socialTasks.steam.groupLinks.push(t),"do"===e&&this.undoneTasks.steam.groupLinks.push(t)):/store\.steampowered\.com\/app\//.test(t)&&/wishlist/gim.test(s)?("undo"===e&&this.socialTasks.steam.wishlistLinks.push(t),"do"===e&&this.undoneTasks.steam.wishlistLinks.push(t)):/store\.steampowered\.com\/curator\//.test(t)?("undo"===e&&this.socialTasks.steam.curatorLinks.push(t),"do"===e&&this.undoneTasks.steam.curatorLinks.push(t)):/^https?:\/\/discord\.com\/invite\//.test(t)?("undo"===e&&this.socialTasks.discord.serverLinks.push(t),"do"===e&&this.undoneTasks.discord.serverLinks.push(t)):C({html:`<li><font class="warning>${G("unKnownTaskType",`${s}(${t})`)}</font></li>`}))}return t.success(),this.undoneTasks=this.uniqueTasks(this.undoneTasks),this.socialTasks=this.uniqueTasks(this.socialTasks),GM_setValue(`khTasks${this.giveawayId}`,this.socialTasks),!0}catch(t){return A(t,"Keyhub.classifyTask"),!1}}verifyTask(){try{C({type:"custom",text:`<li>${G("verifyingTask")}...<font></font></li>`}),$.get(window.location.href,t=>{VerifyTasks(t.match(/onclick="javascript:VerifyTasks\('(.*?)'\)"/)[1])})}catch(t){A(t,"keyhub.verifyTask")}}async checkLeftKey(){try{return"0"===$("#keysleft").text().trim()&&await o().fire({icon:"warning",title:G("notice"),text:G("noKeysLeft"),confirmButtonText:G("confirm"),cancelButtonText:G("cancel"),showCancelButton:!0}).then(t=>{var t=t["value"];t&&window.close()}),!0}catch(t){return A(t,"Keyhub.checkLeftKey"),!1}}checkLogin(){try{return 0<$('a[href*="/connect/steam"]').length&&window.open("/connect/steam","_self"),!0}catch(t){return A(t,"Keyhub.checkLogin"),!1}}}function Yi(){try{var t,e=null===(t=window.location.href.match(/giveaway\/([\d]+)/))||void 0===t?void 0:t[1];return e?(this.giveawayId=e,!0):(C({html:`<li><font class="error">${G("getFailed","GiveawayId")}</font></li>`}),!1)}catch(t){return A(t,"Keyhub.getGiveawayId"),!1}}function Bi(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function Hi(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function Ji(t,e,s){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return s}const Zi={steam:{groupLinks:[],wishlistLinks:[],curatorLinks:[],curatorLikeLinks:[]},twitter:{userLinks:[]},vk:{nameLinks:[]},discord:{serverLinks:[]}};var Qi=new WeakSet,Xi=new WeakSet;class tn extends t{constructor(){super(...arguments),Bi(this,Xi),Bi(this,Qi),Hi(this,"name","Givekey"),Hi(this,"tasks",[]),Hi(this,"socialTasks",{...Zi}),Hi(this,"undoneTasks",{...Zi}),Hi(this,"userId",void 0)}static test(){return"givekey.ru"===window.location.host}init(){try{const e=C({text:G("initing")});if(0<$('a[href*="/auth/steam"]').length)return window.open("/auth/steam","_self"),e.warning(G("needLogin")),!1;if(!Ji(this,Xi,sn).call(this))return!1;var t=$('meta[name="user-id"]').attr("content");return t?(this.userId=t,this.initialized=!0,e.success(),!0):(e.error(G("getFailed",G("userId"))),!1)}catch(t){return A(t,"Givekey.init"),!1}}async classifyTask(e){try{const n=C({text:G("getTasksInfo")});this.socialTasks=GM_getValue(`gkTasks-${this.giveawayId}`)||Zi;for(const a of $('.card-body:has("button") .row')){const r=$(a);var s=/Complete/i.test(r.find("button").text().trim());if(!s||"undo"===e){const o=r.find("#task_check");var t=o.attr("data-id");if(t&&this.tasks.push(t),"verify"!==e){let t=r.find("a").attr("href")||null;var i=r.find("a").text().trim();const l=r.find("i");t&&i&&(/^https?:\/\/givekey\.ru\/giveaway\/[\d]+\/execution_task/.test(t)&&(t=await u(t)),t&&(/^https?:\/\/vk\.com\//.test(t)?(this.socialTasks.vk.nameLinks.push(t),"do"!==e||s||this.undoneTasks.vk.nameLinks.push(t)):/^https?:\/\/steamcommunity\.com\/groups/.test(t)?(this.socialTasks.steam.groupLinks.push(t),"do"!==e||s||this.undoneTasks.steam.groupLinks.push(t)):/^https?:\/\/store\.steampowered\.com\/app\//.test(t)?(this.socialTasks.steam.wishlistLinks.push(t),"do"!==e||s||this.undoneTasks.steam.wishlistLinks.push(t)):/Subscribe/gi.test(i)&&l.hasClass("fa-steam-square")?/^https?:\/\/store\.steampowered\.com\/curator\//.test(t)?(this.socialTasks.steam.curatorLinks.push(t),"do"!==e||s||this.undoneTasks.steam.curatorLinks.push(t)):(this.socialTasks.steam.curatorLikeLinks.push(t),"do"!==e||s||this.undoneTasks.steam.curatorLikeLinks.push(t)):/^https?:\/\/twitter\.com\//.test(t)&&/Subscribe/gi.test(i)?(this.socialTasks.twitter.userLinks.push(t),"do"!==e||s||this.undoneTasks.twitter.userLinks.push(t)):l.hasClass("fa-discord")?(this.socialTasks.discord.serverLinks.push(t),"do"!==e||s||this.undoneTasks.discord.serverLinks.push(t)):C({html:`<li><font class="warning">${G("unKnownTaskType")}: ${i}(${t})</font></li>`})))}}}return n.success(),this.tasks=I(this.tasks),this.undoneTasks=this.uniqueTasks(this.undoneTasks),this.socialTasks=this.uniqueTasks(this.socialTasks),GM_setValue(`gkTasks${this.giveawayId}`,this.socialTasks),!0}catch(t){return A(t,"Givekey.classifyTask"),!1}}async verifyTask(){try{if(!this.initialized&&!this.init())return!1;if(0===this.tasks.length&&!await this.classifyTask("verify"))return!1;for(const t of this.tasks)await Ji(this,Qi,en).call(this,t),await E(1e3);return C({html:`<li><font class="success">${G("allTasksComplete")}</font></li>`}),C({html:`<li><font class="warning">${G("giveKeyNotice")}</font></li>`}),!0}catch(t){return A(t,"Givekey.verifyTask"),!1}}checkLeft(){try{$("#keys_count").text()||o().fire({icon:"warning",title:G("notice"),text:G("noKeysLeft"),confirmButtonText:G("confirm"),cancelButtonText:G("cancel"),showCancelButton:!0}).then(t=>{var t=t["value"];t&&window.close()})}catch(t){A(t,"Givekey.checkLeft")}}}async function en(t){try{const s=C({html:`<li>${G("verifyingTask")}${t}...<font></font></li>`});return new Promise(e=>{$.ajax({url:"https://givekey.ru/giveaway/task",method:"POST",data:`id=${t}&user_id=${this.userId}`,dataType:"json",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},success:t=>{t.btn&&$(`button[data-id=${this.userId}]`).html(t.btn),"ok"===t.status?($(`.task_check_${t.id}`).html(`<button class="btn btn-success mb-2 btn-block" disabled>${t.btn}</button>`),s.success(),e(!0)):("end"===t.status?s.success():s.error(`Error:${t.msg}`),e(!1))},error:t=>{s.error(`Error:${t.statusText}(${t.status})`),e(!1)}})})}catch(t){return A(t,"Givekey.verify"),!1}}function sn(){try{var t,e=null===(t=window.location.href.match(/giveaway\/([\d]+)/))||void 0===t?void 0:t[1];return e?(this.giveawayId=e,!0):(C({text:G("getFailed","GiveawayId")}),!1)}catch(t){return A(t,"Givekey.getGiveawayId"),!1}}function nn(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function an(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function rn(t,e,s){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return s}var on=new WeakSet;async function ln(t){try{for(const c of $(`.giveaways-page-item:contains('${t}'):not(:contains('ENTERED'))`)){var e,s,i,n,a,r,o,l=parseInt((null===(e=$(c).find(".giveaways-page-item-header-points").text().match(/[\d]+/gim))||void 0===e?void 0:e[0])||"999999",10),u=$(c).find(".giveaways-page-item-footer-name").text().trim();if("points"===t&&l>this.myPoints)C({html:`<li><font class="warning">${G("noPoints")}: ${u}</font></li>`});else if("points"!==t||l){if(!("points"===t&&l>this.maxPoints)){const h=C({text:`${G("joiningLottery")}<a href="${$(c).find("a.giveaways-page-item-img-btn-more").attr("href")}" target="_blank">${u}</a>...`}),d=$(c).find("a.giveaways-page-item-img-btn-enter:contains('enter')");if(null===d||void 0===d||null===(s=d.attr("onclick"))||void 0===s||!s.includes("checkUser")||(a=null===(i=d.attr("onclick"))||void 0===i||null===(n=i.match(/[\d]+/))||void 0===n?void 0:n[0])&&checkUser(a),d.attr("href")){const{result:f,statusText:w,status:p,data:m}=await S({url:d.attr("href"),method:"GET"});"Success"===f?null!==m&&void 0!==m&&m.responseText&&/You've entered this giveaway/gim.test(m.responseText)?(h.success(),o=null===(r=m.responseText.match(/Points:[\s]*?([\d]+)/))||void 0===r?void 0:r[1],"points"===t&&o&&(this.myPoints=parseInt(o,10))):h.error(`Error:${null===m||void 0===m?void 0:m.statusText}(${null===m||void 0===m?void 0:m.status})`):h.error(`${f}:${w}(${p})`)}else h.error('Error: No "href".')}}else C({html:`<li><font class="warning">${G("getNeedPointsFailed")}: ${u}</font></li>`})}C({text:"-----END-----"})}catch(t){A(t,"OpiumPulses.toggleTask")}}function un(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function cn(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function hn(t,e,s){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return s}const dn={steam:{groupLinks:[],wishlistLinks:[],curatorLinks:[],curatorLikeLinks:[],followLinks:[],forumLinks:[],announcementLinks:[],workshopVoteLinks:[]},discord:{serverLinks:[]},instagram:{userLinks:[]},vk:{nameLinks:[]},twitch:{channelLinks:[]},reddit:{redditLinks:[]},twitter:{userLinks:[],retweetLinks:[]},youtube:{channelLinks:[],likeLinks:[]}};var fn=new WeakSet;class wn extends t{constructor(){super(...arguments),un(this,fn),cn(this,"name","Keylol"),cn(this,"socialTasks",{...dn}),cn(this,"undoneTasks",{...dn})}static test(){var t;return"keylol.com"===window.location.host&&!window.location.href.includes("mod=forumdisplay")&&!(null===(t=$(".subforum_left_title_left_up a").eq(3).attr("href"))||void 0===t||!t.includes("319"))}init(){return!0}after(){try{const m=$('#postlist>div[id^="post_"]:first');var t=m.find('a[href*="discord.com"]'),e=m.find('a[href*="reddit.com"]'),s=m.find('a[href*="instagram.com"]'),i=m.find('a[href*="twitter.com"]'),n=m.find('a[href*="twitch.tv"]'),a=m.find('a[href*="vk.com"]'),r=m.find('a[href*="store.steampowered.com"]'),o=m.find('a[href*="steamcommunity.com"]');if(0<t.length)for(const v of t){var l=$(v).attr("href");l&&hn(this,fn,pn).call(this,v,"discord","serverLinks",l)}if(0<e.length)for(const g of e){var u=$(g).attr("href");u&&hn(this,fn,pn).call(this,g,"reddit","redditLinks",u)}if(0<s.length)for(const k of s){var c=$(k).attr("href");c&&hn(this,fn,pn).call(this,k,"instagram","userLinks",c)}if(0<i.length)for(const y of i){var h=$(y).attr("href");h&&(/https:\/\/twitter\.com\/.*?\/status\/[\d]+/.test(h)?hn(this,fn,pn).call(this,y,"twitter","retweetLinks",h):hn(this,fn,pn).call(this,y,"twitter","userLinks",h))}if(0<n.length)for(const T of n){var d=$(T).attr("href");d&&hn(this,fn,pn).call(this,T,"twitch","channelLinks",d)}if(0<a.length)for(const b of a){var f=$(b).attr("href");f&&hn(this,fn,pn).call(this,b,"vk","nameLinks",f)}if(0<r.length)for(const x of r){var w=$(x).attr("href");w&&(/app\/[\d]+/.test(w)?(hn(this,fn,pn).call(this,x,"steam","followLinks",w),hn(this,fn,pn).call(this,x,"steam","wishlistLinks",w)):/curator\/[\d]+/.test(w)?hn(this,fn,pn).call(this,x,"steam","curatorLinks",w):/(publisher|developer|franchise)\/.+/.test(w)?hn(this,fn,pn).call(this,x,"steam","curatorLikeLinks",w):/newshub\/app\/[\d]+\/view\/[\d]+/.test(w)&&hn(this,fn,pn).call(this,x,"steam","announcementLinks",w))}if(0<o.length)for(const L of o){var p=$(L).attr("href");p&&(/groups\/.+/.test(p)?hn(this,fn,pn).call(this,L,"steam","groupLinks",p):/announcements\/detail\/[\d]+/.test(p)&&hn(this,fn,pn).call(this,L,"steam","announcementLinks",p))}}catch(t){A(t,"keylol.after")}}classifyTask(t){try{this.socialTasks={...dn},this.undoneTasks={...dn};for(const n of $('.auto-task-keylol[selected="selected"]')){const a=$(n);var e=a.attr("data-social"),s=a.attr("data-type"),i=a.attr("data-link");e&&s&&i&&("do"===t&&this.undoneTasks[e][s].push(i),"undo"===t&&this.socialTasks[e][s].push(i))}return this.undoneTasks=this.uniqueTasks(this.undoneTasks),this.socialTasks=this.uniqueTasks(this.socialTasks),!0}catch(t){return A(t,"Keylol.classifyTask"),!1}}}function pn(t,e,s,i){try{$(t).after('<a href="javascript:void(0);" class="auto-task-keylol" target="_self"'+" onclick=\"this.getAttribute('selected') ? this.removeAttribute('selected') : this.setAttribute('selected', 'selected')\""+` data-social="${e}" data-type="${s}" data-link="${i}">${s.replace("Links","")}</a>`)}catch(t){A(t,"keylol.addBtn")}}function mn(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function vn(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const gn={steam:{groupLinks:[],wishlistLinks:[],followLinks:[],curatorLikeLinks:[]}};var kn=new WeakSet;class yn extends t{constructor(){super(...arguments),mn(this,kn),vn(this,"name","Opquests"),vn(this,"undoneTasks",{...gn})}static test(){return"opquests.com"===window.location.host}async before(){try{this.checkLogin()||C({html:`<li><font class="warning>${G("checkLoginFailed")}</font></li>`})}catch(t){A(t,"Opquests.before")}}init(){try{const t=C({text:G("initing")});return 0<$('a[href*="/auth/redirect"]').length?(window.open("/auth/redirect","_self"),t.warning(G("needLogin")),!1):!!function(t,e,s){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return s}(this,kn,Tn).call(this)&&(this.initialized=!0,t.success(),!0)}catch(t){return A(t,"Opquests.init"),!1}}async classifyTask(t){try{if("undo"===t)return C({text:G("cannotUndo")}),!1;const i=C({text:G("getTasksInfo")});for(const n of $('.w-full:contains("Validate") .items-center')){var e=$(n).find('a:contains("Open")').attr("href"),s=$(n).find("div").eq(1).text().trim();e&&(/steamcommunity\.com\/groups\//.test(e)?this.undoneTasks.steam.groupLinks.push(e):/store\.steampowered\.com\/app\//.test(e)?/wishlist/gim.test(s)?this.undoneTasks.steam.wishlistLinks.push(e):/follow/gim.test(s)&&this.undoneTasks.steam.followLinks.push(e):/store\.steampowered\.com\/(publisher|developer)\//.test(e)&&/follow/gim.test(s)?this.undoneTasks.steam.curatorLikeLinks.push(e):C({html:`<li><font class="warning">${G("unKnownTaskType",`${s}(${e})`)}</font></li>`}))}return i.success(),this.undoneTasks=this.uniqueTasks(this.undoneTasks),GM_setValue(`oqTasks${this.giveawayId}`,this.socialTasks),!0}catch(t){return A(t,"Opquests.classifyTask"),!1}}checkLogin(){try{return 0<$('a[href*="/auth/redirect"]').length&&window.open("/auth/redirect","_self"),!0}catch(t){return A(t,"Opquests.checkLogin"),!1}}}function Tn(){try{var t,e=null===(t=window.location.href.match(/quests\/([\d]+)/))||void 0===t?void 0:t[1];return e?(this.giveawayId=e,!0):(C({html:`<li><font class="error">${G("getFailed","GiveawayId")}</font></li>`}),!1)}catch(t){return A(t,"Opquests.getGiveawayId"),!1}}function $n(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function bn(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function xn(t,e,s){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return s}const Ln={steam:{groupLinks:[],wishlistLinks:[],followLinks:[],curatorLinks:[],curatorLikeLinks:[]},twitter:{userLinks:[],retweetLinks:[]},twitch:{channelLinks:[]},discord:{serverLinks:[]},youtube:{channelLinks:[]},extra:{gleam:[]}},Sn={vlootUsername:"",gameroundUsername:""};var In=new WeakSet,_n=new WeakSet,An=new WeakSet;class Gn extends t{constructor(){super(...arguments),$n(this,An),$n(this,_n),$n(this,In),bn(this,"name","Gleam"),bn(this,"undoneTasks",{...Ln}),bn(this,"socialTasks",{...Ln}),bn(this,"options",{...Sn,...GM_getValue("GleamOptions")})}static test(){return"gleam.io"===window.location.host}init(){try{const t=C({text:G("initing")});return xn(this,_n,Cn).call(this)?(this.initialized=!0,t.success(),!0):!1}catch(t){return A(t,"Gleam.init"),!1}}async classifyTask(e){try{const f=C({text:G("getTasksInfo")});var t,s,i,n,a,r,o;this.socialTasks=GM_getValue(`gleamTasks-${this.giveawayId}`)||{...Ln};for(const w of $(".entry-content .entry-method")){const p=$(w);if("do"!==e||0!==p.find("i.fa-question").length){const m=p.find(".icon-wrapper i"),v=p.find(".user-links"),g=p.find(".expandable"),k=g.find("a.btn");if(0<k.length)for(const y of k){const T=$(y);var l=T.attr("href");T.removeAttr("href")[0].click(),T.attr("href",l)}if(m.hasClass("fa-twitter")){var u=p.find('a[href^="https://twitter.com/"]').attr("href");u&&(/follow/gi.test(v.text().trim())?("undo"===e&&this.socialTasks.twitter.userLinks.push(u),"do"===e&&this.undoneTasks.twitter.userLinks.push(u)):/retweet/gim.test(v.text().trim())&&("undo"===e&&this.socialTasks.twitter.retweetLinks.push(u),"do"===e&&this.undoneTasks.twitter.retweetLinks.push(u)))}else if(m.hasClass("fa-twitch"))!/follow/gim.test(v.text().trim())||(s=p.find('a[href^="https://twitch.tv/"]').attr("href"))&&("undo"===e&&this.socialTasks.twitch.channelLinks.push(s),"do"===e&&this.undoneTasks.twitch.channelLinks.push(s));else if(m.hasClass("fa-discord")){if(/join/gim.test(v.text().trim())){let t=p.find('a[href^="https://discord.com/invite/"]').attr("href");if(!t){var c,h,d=null===(c=p.find('a[href^="https://discord.gg/"]').attr("href"))||void 0===c||null===(h=c.match(/discord\.gg\/([^/]+)/))||void 0===h?void 0:h[1];if(!d)continue;t=`https://discord.com/invite/${d}`}"undo"===e&&this.socialTasks.discord.serverLinks.push(t),"do"===e&&this.undoneTasks.discord.serverLinks.push(t)}}else m.hasClass("fa-external-link-square-alt")||(m.hasClass("fa-youtube")?!/subscribe/gim.test(v.text().trim())||(i=p.find('a[href^="https://www.youtube.com/channel/"]').attr("href"))&&("undo"===e&&this.socialTasks.youtube.channelLinks.push(i),"do"===e&&this.undoneTasks.youtube.channelLinks.push(i)):null!==(t=m.attr("class"))&&void 0!==t&&t.includes("steam")?/join.*group/gi.test(v.text().trim())?(n=p.find('a[href^="https://steamcommunity.com/groups/"]').attr("href"))&&("undo"===e&&this.socialTasks.steam.groupLinks.push(n),"do"===e&&this.undoneTasks.steam.groupLinks.push(n)):!/follow.*curator/gi.test(v.text().trim())||(a=p.find('a[href^="https://store.steampowered.com/curator/"]').attr("href"))&&("undo"===e&&this.socialTasks.steam.curatorLinks.push(a),"do"===e&&this.undoneTasks.steam.curatorLinks.push(a)):m.hasClass("fa-shield")&&v.text().trim().includes("earn.vloot.io")?g.find("input").val(this.options.vlootUsername):m.hasClass("fa-gamepad-alt")&&v.text().trim().includes("Gameround")?g.find("input").val(this.options.gameroundUsername):m.hasClass("fa-bullhorn")&&v.text().trim().includes("Complete")?"do"===e&&(!(r=k.attr("href"))||(o=await xn(this,An,Pn).call(this,r))&&this.undoneTasks.extra.gleam.push(o)):m.hasClass("fa-question")||C({html:`<li><font class="warning">${G("unKnownTaskType")}: ${v.text().trim()}</font></li>`}))}}return f.success(),this.undoneTasks=this.uniqueTasks(this.undoneTasks),this.socialTasks=this.uniqueTasks(this.socialTasks),GM_setValue(`gleamTasks${this.giveawayId}`,this.socialTasks),!0}catch(t){return A(t,"Gleam.classifyTask"),!1}}async extraDoTask(t){var t=t["gleam"];try{const e=[];for(const s of t)e.push(xn(this,In,En).call(this,s));return Promise.all(e).then(()=>!0)}catch(t){return A(t,"Gleam.extraDoTask"),!1}}async after(){try{if(window.location.search.includes("8b07d23f4bfa65f9")){const s=setInterval(()=>{0<$(".entry-content .entry-method i.fa-check").length&&(clearInterval(s),window.close())});for(const i of $(".entry-content .entry-method")){const n=$(i).find(".user-links"),a=$(i).find(".expandable");var t=a.find("a.btn,a:contains(Continue),button:contains(Continue)");if(0<t.length)for(const r of t){const o=$(r);var e=o.attr("href");o.removeAttr("href")[0].click(),o.attr("href",e),await E(1e3)}n[0].click(),await E(1e3)}C({html:`<li><font class="warning">${G("gleamTaskNotice")}</font></li>`})}}catch(t){return A(t,"Gleam.after"),!1}}}async function En(e){try{const s=C({text:G("doingGleamTask")});return new Promise(t=>{GM_openInTab(`${e}?8b07d23f4bfa65f9`,{active:!0,insert:!0,setParent:!0}).onclose=()=>{s.success(),t(!0)}})}catch(t){return A(t,"Gleam.doGleamTask"),!1}}function Cn(){try{var t=window.location.pathname;return t?(this.giveawayId=t,!0):(C({text:G("getFailed","GiveawayId")}),!1)}catch(t){return A(t,"Gleam.getGiveawayId"),!1}}async function Pn(t){try{const i=C({text:G("gettingGleamLink")}),{result:n,statusText:a,status:r,data:o}=await S({url:t,method:"GET"});if("Success"!==n)return i.error(`${n}:${a}(${r})`),!1;if(200!==(null===o||void 0===o?void 0:o.status))return i.error(`Error:${null===o||void 0===o?void 0:o.statusText}(${null===o||void 0===o?void 0:o.status})`),!1;var e,s=null===(e=o.responseText.match(/href="(https:\/\/gleam\.io\/.*?\/.+?)"/))||void 0===e?void 0:e[1];return s?(i.success(),s):(i.error(`Error:${G("getLinkFailed")}`),!1)}catch(t){return A(t,"Gleam.getGleamLink"),!1}}function Wn(){const r={...jn,...GM_getValue("whiteList")||{}};let t=`<form id="whiteListForm" class="auto-task-form">
  <table class="auto-task-table"><thead><tr><td>${G("website")}</td><td>${G("type")}</td><td>${G("edit")}</td></tr></thead><tbody>`;for(const[i,n]of Object.entries(r))t+=Object.keys(n).map((t,e)=>{var s;return null!==(s=Vn[i])&&void 0!==s&&s.includes(t)?"":`<tr>${0===e?`<th rowspan="${Object.keys(n).length-(Vn[i]||[]).length}">${i}</th>`:""}<td>${t}</td><td><button class="editWhiteList" data-value="${i}.${t}">${G("edit")}</button></td></tr>`}).join("");t+="</tbody></table></form>",o().fire({title:G("whiteListOptions"),html:t,showConfirmButton:!1,showCloseButton:!0}),$(".editWhiteList").on("click",function(){var t;const e=$(this).attr("data-value");if(e){const[n,a]=e.split(".");null!==r&&void 0!==r&&null!==(t=r[n])&&void 0!==t&&t[a]?(o().fire({title:G("changeWhiteListOption",e),input:"textarea",html:`<input id="socialLink" class="swal2-input" placeholder="在此处输入链接获取id">
        <button id="link2id" data-type="${e}" class="swal2-confirm swal2-styled">获取id</button>`,inputValue:r[n][a].join("\n"),showConfirmButton:!0,confirmButtonText:G("save"),showCancelButton:!0,cancelButtonText:G("close"),showDenyButton:!0,denyButtonText:G("return")}).then(t=>{let{isDenied:e,isConfirmed:s,value:i}=t;e?Wn():s&&(r[n][a]=i.split("\n"),GM_setValue("whiteList",r),o().fire({title:G("changeWhiteListSuccess"),icon:"success"}))}),$("#link2id").on("click",async function(){var t=$(this).attr("data-type");$("#socialLink").val(await async function(t){var e,s,i,n,a,r,o,l;const u=$("#socialLink").val();let c="";switch(t){case"discord.servers":c=(null===(e=u.match(/invite\/(.+)/))||void 0===e?void 0:e[1])||"";break;case"instagram.users":c=(null===(s=u.match(/https:\/\/www\.instagram\.com\/(.+)?\//))||void 0===s?void 0:s[1])||"";break;case"twitch.channels":c=(null===(s=u.match(/https:\/\/(www\.)?twitch\.tv\/(.+)/))||void 0===s?void 0:s[2])||"";break;case"twitter.users":c=(null===(i=u.match(/https:\/\/twitter\.com\/(.+)/))||void 0===i?void 0:i[1])||"";break;case"twitter.retweets":c=(null===(i=u.match(/https:\/\/twitter\.com\/.*?\/status\/([\d]+)/))||void 0===i?void 0:i[1])||"";break;case"vk.names":c=(null===(n=u.match(/https:\/\/vk\.com\/([^/]+)/))||void 0===n?void 0:n[1])||"";break;case"youtube.channels":c=(null===(n=await ss(u,"channel"))||void 0===n||null===(a=n.params)||void 0===a?void 0:a.channelId)||"";break;case"youtube.likes":c=(null===(a=await ss(u,"likeVideo"))||void 0===a||null===(r=a.params)||void 0===r?void 0:r.videoId)||"";break;case"reddit.reddits":c=(null===(r=u.match(/https?:\/\/www\.reddit\.com\/user\/([^/]*)/))||void 0===r?void 0:r[1])||(null===(r=u.match(/https?:\/\/www\.reddit\.com\/r\/([^/]*)/))||void 0===r?void 0:r[1])||"";break;case"steam.groups":c=(null===(o=u.match(/groups\/(.+)\/?/))||void 0===o?void 0:o[1])||"";break;case"steam.wishlists":case"steam.follows":case"steam.forums":c=(null===(o=u.match(/app\/([\d]+)/))||void 0===o?void 0:o[1])||"";break;case"steam.workshops":c=(null===(l=u.match(/\?id=([\d]+)/))||void 0===l?void 0:l[1])||"";break;case"steam.curators":if(u.includes("curator"))c=(null===(l=u.match(/curator\/([\d]+)/))||void 0===l?void 0:l[1])||"";else{var h=null===(h=u.match(/https?:\/\/store\.steampowered\.com\/(.*?)\/([^/?]+)/))||void 0===h?void 0:h.slice(1,3);if(!h||2!==h.length)break;const d=new gi;await d.init()&&(c=await d.getCuratorId(h[0],h[1])||"")}}return c}(t))})):C({html:`<li><font class="warning">${G("whiteListNotFound",e)}</font></li>`})}})}const jn={discord:{servers:[]},instagram:{users:[]},twitch:{channels:[]},twitter:{users:[],retweets:[],likes:[]},vk:{names:[]},youtube:{channels:[],likes:[]},reddit:{reddits:[]},steam:{groups:[],wishlists:[],follows:[],forums:[],workshops:[],curators:[],workshopVotes:[],curatorLikes:[],announcements:[]}},Vn={steam:["workshopVotes","curatorLikes","announcements"],twitter:["likes"]},Mn=Wn;var On;const Fn=function(e,s){let t=`<form id="websiteOptionsForm" class="auto-task-form">
  <table class="auto-task-table"><thead><tr><td>${G("option")}</td><td>${G("value")}</td></tr></thead><tbody>`;for(var[i,n]of Object.entries(s))t+=`<tr><td>${i}</td><td><input class="editOption" type="text" name="${i}" value="${n}"/></td></tr>`;t+="</tbody></table></form>",o().fire({title:G("websiteOptions"),html:t,showConfirmButton:!0,confirmButtonText:G("save"),showCancelButton:!0,cancelButtonText:G("close")}).then(t=>{var t=t["isConfirmed"];t&&($("#websiteOptionsForm").serializeArray().map(t=>(s[t.name]=t.value,t)),GM_setValue(`${e}Options`,s),o().fire({title:G("changeWebsiteOptionsSuccess"),icon:"success"}))})};let Dn;for(const yi of[Ii,Wi,class{constructor(){var t,e,s;Vi(this,Fi),Vi(this,Oi),s="Indiedb",(e="name")in(t=this)?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}static test(){return"www.indiedb.com"===window.location.host}async before(){try{this.checkLogin()||C({html:`<li><font class="warning>${G("checkLoginFailed")}</font></li>`})}catch(t){A(t,"Indiedb.before")}}async doTask(){try{return await Mi(this,Oi,Di).call(this)?Mi(this,Fi,Ui).call(this):!1}catch(t){return A(t,"Indiedb.doTask"),!1}}checkLogin(){try{return 0<$("a.buttonenter:contains(Register to join)").length&&window.open("/members/login","_self"),!0}catch(t){return A(t,"Indiedb.checkLogin"),!1}}},Ki,tn,class extends Wi{constructor(){var t,e,s;super(...arguments),s="GiveeClub",(e="name")in(t=this)?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s}static test(){return/^https?:\/\/givee\.club\/.*?\/event\/[\d]+/.test(window.location.href)}async before(){try{this.checkLogin()||C({html:`<li><font class="warning>${G("checkLoginFailed")}</font></li>`})}catch(t){A(t,"GiveeClub.before")}}init(){try{const t=C({text:G("initing")});return this.checkLogin()?!!this.getGiveawayId()&&(this.initialized=!0,t.success(),!0):(t.warning(G("needLogin")),!1)}catch(t){return A(t,"GiveeClub.init"),!1}}async classifyTask(){try{const t=C({text:G("getTasksInfo")});this.socialTasks=GM_getValue(`gcTasks-${this.giveawayId}`)||Ci;const e=[];for(const n of $(".event-actions tr"))e.push(new Promise(e=>{const t=$(n).find(".event-action-label a"),s=$(n).find(".event-action-icon i").attr("class")||"",i=t.text().trim();if(s.includes("ban")||/AdBlock/i.test(i)||s.includes("envelope"))return e(!0);u(t.attr("href")).then(t=>t?(/^https?:\/\/steamcommunity\.com\/groups/.test(t)?this.undoneTasks.steam.groupLinks.push(t):/like.*announcement/gi.test(i)?this.undoneTasks.steam.announcementLinks.push(t):s.includes("plus")&&/^https?:\/\/store\.steampowered\.com\/app\//.test(t)?this.undoneTasks.steam.wishlistLinks.push(t):/^https?:\/\/store\.steampowered\.com\/curator\//.test(t)?this.undoneTasks.steam.curatorLinks.push(t):s.includes("steam")&&/follow|subscribe/gim.test(i)?this.undoneTasks.steam.curatorLikeLinks.push(t):/subscribe.*steam.*forum/gim.test(i)?this.undoneTasks.steam.forumLinks.push(t):s.includes("discord")?this.undoneTasks.discord.serverLinks.push(t):s.includes("instagram")?this.undoneTasks.instagram.userLinks.push(t):s.includes("twitch")?this.undoneTasks.twitch.channelLinks.push(t):s.includes("reddit")?this.undoneTasks.reddit.redditLinks.push(t):/watch.*art/gim.test(i)?this.undoneTasks.steam.workshopVoteLinks.push(t):/subscribe.*youtube.*channel/gim.test(i)?this.undoneTasks.youtube.channelLinks.push(t):/(watch|like).*youtube.*video/gim.test(i)||(s.includes("youtube")||s.includes("thumbs-up"))&&/(watch|like).*video/gim.test(i)?this.undoneTasks.youtube.likeLinks.push(t):s.includes("vk")||/join.*vk.*group/gim.test(i)?this.undoneTasks.vk.nameLinks.push(t):/(on twitter)|(Follow.*on.*Facebook)/gim.test(i)||/follow.*button/gim.test(i)&&this.undoneTasks.steam.followLinks.push(t),void e(!0)):e(!1)).catch(t=>(A(t,"GiveeClub.classifyTask->getRedirectLink"),!1))}));return await Promise.all(e),t.success(),this.undoneTasks=this.uniqueTasks(this.undoneTasks),this.socialTasks=this.undoneTasks,GM_setValue(`gcTasks${this.giveawayId}`,this.socialTasks),!0}catch(t){return A(t,"GiveeClub.classifyTask"),!1}}checkLogin(){try{return 0<$('a[href*="/account/auth"]').length&&window.open($('a[href*="/account/auth"]').attr("href"),"_self"),!0}catch(t){return A(t,"GiveeClub.checkLogin"),!1}}getGiveawayId(){var t=null===(t=window.location.href.match(/\/event\/([\d]+)/))||void 0===t?void 0:t[1];return t?(this.giveawayId=t,!0):(C({text:G("getFailed","GiveawayId")}),!1)}},class{constructor(){nn(this,on),an(this,"name","OpiumPulses"),an(this,"maxPoints",0),an(this,"myPoints",0)}static test(){return"www.opiumpulses.com"===window.location.host}async before(){try{this.checkLogin()||C({html:`<li><font class="warning>${G("checkLoginFailed")}</font></li>`})}catch(t){A(t,"OpiumPulses.before")}}async doFreeTask(){try{rn(this,on,ln).call(this,"FREE")}catch(t){A(t,"OpiumPulses.doFreeTask")}}async doPointTask(){try{var t;this.myPoints=parseInt((null===(t=$(".page-header__nav-func-user-nav-items.points-items").text().match(/[\d]+/gim))||void 0===t?void 0:t[0])||"0",10),rn(this,on,ln).call(this,"points")}catch(t){A(t,"OpiumPulses.doPointTask")}}init(){return!0}classifyTask(){return!0}checkLogin(){try{return 0<$('a[href*="/site/login"]').length&&window.open("/site/login","_self"),!0}catch(t){return A(t,"OpiumPulses.checkLogin"),!1}}},wn,yn,Gn])if(yi.test()){Dn=new yi;break}"discord.com"===window.location.hostname&&(On=null===(t=window.localStorage)||void 0===t||null===(On=t.getItem("token"))||void 0===On?void 0:On.replace(/^"|"$/g,""),GM_setValue("discordAuth",{auth:On}),On&&"#auth"===window.location.hash&&(window.close(),o().fire("","如果此页面没有自动关闭，请自行关闭本页面。"))),window.location.hostname,window.onload=()=>{var t,e,s;if("www.twitch.tv"===window.location.hostname&&"#auth"===window.location.hash&&(t=d.get("auth-token"),!!d.get("login")?(GM_setValue("twitchAuth",{authToken:t,clientId:null===(t=commonOptions)||void 0===t||null===(e=t.headers)||void 0===e?void 0:e["Client-ID"]}),window.close(),o().fire("","如果此页面没有自动关闭，请自行关闭本页面。")):o().fire("","请先登录！")),"twitter.com"===window.location.hostname&&"#auth"===window.location.hash&&(s=d.get("ct0"),!!d.get("twid")&&s?(GM_setValue("twitterAuth",{ct0:s}),window.close(),o().fire("","如果此页面没有自动关闭，请自行关闭本页面。")):o().fire("","请先登录！")),"www.youtube.com"===window.location.hostname&&"#auth"===window.location.hash&&((s=d.get("__Secure-3PAPISID"))?(GM_setValue("youtubeAuth",{PAPISID:s}),window.close(),o().fire("","如果此页面没有自动关闭，请自行关闭本页面。")):o().fire("","请先登录！")),"www.reddit.com"===window.location.hostname&&("#auth"===window.location.hash||"#auth"===GM_getValue("redditAuth"))){const i=$("#redesign-beta-optin-btn");if(0<i.length)return GM_setValue("redditAuth","#auth"),i[0].click();GM_setValue("redditAuth",null),window.close(),o().fire("","如果此页面没有自动关闭，请自行关闭本页面。")}Dn&&($("body").append('<div id="auto-task-info"></div>'),Dn.before&&Dn.before(),Dn.after&&Dn.after(),Dn.doTask&&GM_registerMenuCommand("doTask",()=>{Dn.doTask()}),Dn.undoTask&&GM_registerMenuCommand("undoTask",()=>{Dn.undoTask()}),Dn.verifyTask&&GM_registerMenuCommand("verifyTask",()=>{Dn.verifyTask()}),Dn.getKey&&GM_registerMenuCommand("getKey",()=>{Dn.getKey()}),Dn.doFreeTask&&GM_registerMenuCommand("doFreeTask",Dn.doFreeTask),Dn.doPointTask&&GM_registerMenuCommand("doPointTask",Dn.doPointTask),GM_registerMenuCommand("whiteList",Mn),Dn.options&&GM_registerMenuCommand("options",()=>{Fn(Dn.name,Dn.options)}),unsafeWindow.website=Dn,GM_addStyle(`
  #auto-task-info {
    position: fixed;
    bottom: 10px;
    right: 10px;
    width: 300px;
    max-width: 60%;
    max-height: 600px;
    overflow-y: auto;
    color: #000;
    background-color: #fff;
  }
  .auto-task-keylol {
    text-transform: capitalize;
    margin-left: 10px;
    text-decoration: none !important;
    border: solid 2px;
    border-radius: 5px;
    padding: 0 2px;
  }
  .auto-task-keylol[selected="selected"] {
    background-color: blue;
    color: #fff;
  }
  #auto-task-info .success {
    color: green;
  }
  #auto-task-info .error {
    color: red;
  }
  #auto-task-info .warning {
    color: blue;
  }
  #auto-task-info .info {
    color: yellow;
  }
  .auto-task-form table {
    font-family: verdana, arial, sans-serif;
    font-size: 11px;
    color: #333333;
    border-width: 1px;
    border-color: #999999;
    border-collapse: collapse;
    width: 100%;
  }

  .auto-task-form table th {
    background-color: #c3dde0;
    border-width: 1px;
    padding: 8px;
    border-style: solid;
    border-color: #a9c6c9;
  }

  .auto-task-form table tr {
    background-color: #d4e3e5;
  }

  .auto-task-form table tr:hover {
    background-color: #ffff66;
  }

  .auto-task-form table td {
    border-width: 1px;
    padding: 8px;
    border-style: solid;
    border-color: #a9c6c9;
  }
`),console.log("%c%s","color:#1bbe1a","Auto Task脚本初始化完成！"))}}();